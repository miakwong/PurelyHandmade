<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Designer Management - Purely Homemade</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/src/client/css/global.css" rel="stylesheet">
  <link href="/src/client/css/style.css" rel="stylesheet">
  <link href="/src/client/css/navbar.css" rel="stylesheet">
  <link href="/src/client/css/admin.css" rel="stylesheet">
  
  <style>
    /* Style for action buttons */
    .action-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Admin button styles */
    .admin-btn-sm {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 4px;
    }
    
    /* Style for category featured badge */
    .badge-success {
      background-color: #5a8c70;
      color: white;
    }
  </style>
</head>
<body>

<!-- Navbar Placeholder -->
<div id="navbar-placeholder"></div>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="bi bi-speedometer2 me-2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="products.html">
              <i class="bi bi-box me-2"></i>
              Products
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="categories.html">
              <i class="bi bi-tags me-2"></i>
              Categories
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="designers.html">
              <i class="bi bi-palette me-2"></i>
              Designers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="orders.html">
              <i class="bi bi-cart-check me-2"></i>
              Orders
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="users.html">
              <i class="bi bi-people me-2"></i>
              Users
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="comments.html">
              <i class="bi bi-chat-dots me-2"></i>
              Reviews
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="reports.html">
              <i class="bi bi-graph-up me-2"></i>
              Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="settings.html">
              <i class="bi bi-gear me-2"></i>
              Settings
            </a>
          </li>
        </ul>
      </div>
    </nav>
    
    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2"><i class="bi bi-person-badge me-2 text-primary"></i>Designer Management</h1>
        <div>
          <a href="/src/client/views/auth/profile.html" class="btn btn-outline-secondary">
            <i class="bi bi-person me-2"></i>Back to Profile
          </a>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col">
              <h5 class="mb-0">Designer Management</h5>
            </div>
            <div class="col-auto">
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#designerModal" onclick="resetDesignerForm()">
                <i class="bi bi-plus-circle me-2"></i>Add Designer
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- Add filter section -->
          <div class="mb-4 p-3 border rounded bg-light">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="filter-name" class="form-label">Designer Name</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="bi bi-person"></i></span>
                  <input type="text" class="form-control" id="filter-name" placeholder="Filter by designer name">
                </div>
              </div>
              <div class="col-md-6">
                <label for="filter-specialty" class="form-label">Specialty</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="bi bi-tools"></i></span>
                  <input type="text" class="form-control" id="filter-specialty" placeholder="Filter by specialty">
                </div>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-12 d-flex justify-content-end">
                <button class="btn btn-outline-secondary me-2" onclick="resetFilters()">
                  <i class="bi bi-x-circle me-1"></i>Clear
                </button>
                <button class="btn btn-primary" onclick="applyFilters()">
                  <i class="bi bi-search me-1"></i>Search
                </button>
              </div>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Avatar</th>
                  <th>Name</th>
                  <th>Specialty</th>
                  <th>Products</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody id="designerTableBody">
                <!-- Designer data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Designer Modal -->
<div class="modal fade" id="designerModal" tabindex="-1" aria-labelledby="designerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="designerModalLabel">Add New Designer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="designerForm">
          <input type="hidden" id="designerId">
          <div class="row">
            <div class="col-md-8">
              <div class="mb-3">
                <label for="designerName" class="form-label">Designer Name</label>
                <input type="text" class="form-control" id="designerName" required>
              </div>
              <div class="mb-3">
                <label for="designerSpecialty" class="form-label">Specialty</label>
                <input type="text" class="form-control" id="designerSpecialty" required>
              </div>
              <div class="mb-3">
                <label for="designerBio" class="form-label">Biography</label>
                <textarea class="form-control" id="designerBio" rows="3" required></textarea>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Profile Images</label>
                <div id="designerImagesContainer">
                  <!-- Image previews will be added here -->
                </div>
                <div class="d-grid mt-2">
                  <button type="button" class="admin-btn admin-btn-primary" onclick="document.getElementById('designerImage').click()">
                    <i class="bi bi-upload me-1"></i> Upload Images
                  </button>
                </div>
                <input type="file" id="designerImage" accept="image/*" multiple style="display: none;" onchange="previewDesignerImages(event)">
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Social Media Links</label>
            <div class="input-group mb-2">
              <span class="input-group-text"><i class="bi bi-instagram"></i></span>
              <input type="url" class="form-control" id="designerInstagram" placeholder="Instagram URL">
            </div>
            <div class="input-group mb-2">
              <span class="input-group-text"><i class="bi bi-pinterest"></i></span>
              <input type="url" class="form-control" id="designerPinterest" placeholder="Pinterest URL">
            </div>
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-shop"></i></span>
              <input type="url" class="form-control" id="designerEtsy" placeholder="Etsy URL">
            </div>
          </div>
          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="designerFeatured">
              <label class="form-check-label" for="designerFeatured">
                Set as Featured Designer
              </label>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="admin-btn admin-btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="admin-btn admin-btn-primary" onclick="saveDesigner()">Save Designer</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer Placeholder -->
<div id="footer-placeholder"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/src/client/js/common.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Load nav and footer
    loadNavbar();
    loadFooter();
    
    // Check user permissions
    setTimeout(() => {
      const currentUser = DataService.getCurrentUser();
      if (!currentUser || currentUser.isAdmin !== true) {
        window.location.href = '/src/client/views/auth/login.html?redirect=admin';
      } else {
        // Load designers data
        loadDesigners();
      }
    }, 100);
  });
  
  // Designer management functions
  function loadDesigners() {
    const designers = JSON.parse(localStorage.getItem('designers') || '[]');
    const products = JSON.parse(localStorage.getItem('products') || '[]');
    const tableBody = document.getElementById('designerTableBody');
    
    if (!tableBody) {
      console.error('designerTableBody element not found! DOM may not be fully loaded.');
      return; // Exit the function early if tableBody doesn't exist
    }
    
    // Filter designers based on filters
    const filteredDesigners = filterDesigners(designers);
    
    if (filteredDesigners.length === 0) {
      tableBody.innerHTML = `
        <tr>
          <td colspan="5" class="text-center py-4">
            <div class="py-5">
              <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
              <p class="text-muted mt-3">No designers found matching your search criteria</p>
              <button class="btn btn-outline-secondary btn-sm mt-2" onclick="resetFilters()">
                Clear Filters
              </button>
            </div>
          </td>
        </tr>
      `;
      return;
    }
    
    tableBody.innerHTML = filteredDesigners.map(designer => {
      const designerProducts = products.filter(p => p.designerId === designer.id);
      return `
        <tr>
          <td>
            <img src="${designer.image}" alt="${designer.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">
          </td>
          <td>
            <div class="d-flex flex-column">
              <div class="fw-medium">${designer.name}</div>
              ${designer.featured ? '<span class="badge badge-success mt-1"><i class="bi bi-star-fill me-1"></i>Featured</span>' : ''}
            </div>
          </td>
          <td>${designer.specialty}</td>
          <td>${designerProducts.length} products</td>
          <td class="text-center">
            <div class="action-buttons">
              <button class="admin-btn admin-btn-primary admin-btn-sm me-1" onclick="editDesigner('${designer.id}')">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="admin-btn admin-btn-danger admin-btn-sm me-1" onclick="deleteDesigner('${designer.id}')">
                <i class="bi bi-trash"></i>
              </button>
              <a href="/src/client/views/designer/designer-page.html?id=${designer.id}" class="admin-btn admin-btn-info admin-btn-sm me-1" target="_blank">
                <i class="bi bi-eye"></i>
              </a>
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }

  function previewDesignerImages(event) {
    const container = document.getElementById('designerImagesContainer');
    const files = event.target.files;
    
    if (files.length === 0) return;
    
    // Clear existing previews when adding new images
    container.innerHTML = '';
    
    Array.from(files).forEach(file => {
      const reader = new FileReader();
      reader.onload = function(e) {
        container.innerHTML += `
          <div class="position-relative d-inline-block me-2 mb-2">
            <img src="${e.target.result}" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;">
            <button type="button" class="btn-close position-absolute top-0 end-0" 
              style="background-color: white;" onclick="this.parentElement.remove()"></button>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    });
  }

  function resetDesignerForm() {
    document.getElementById('designerForm').reset();
    document.getElementById('designerId').value = '';
    document.getElementById('designerImagesContainer').innerHTML = '';
    document.getElementById('designerModalLabel').textContent = 'Add New Designer';
  }

  function editDesigner(id) {
    const designers = JSON.parse(localStorage.getItem('designers') || '[]');
    const designer = designers.find(d => d.id === id);
    
    if (designer) {
      document.getElementById('designerId').value = designer.id;
      document.getElementById('designerName').value = designer.name;
      document.getElementById('designerSpecialty').value = designer.specialty;
      document.getElementById('designerBio').value = designer.bio;
      document.getElementById('designerInstagram').value = designer.social?.instagram || '';
      document.getElementById('designerPinterest').value = designer.social?.pinterest || '';
      document.getElementById('designerEtsy').value = designer.social?.etsy || '';
      document.getElementById('designerFeatured').checked = designer.featured || false;
      
      const container = document.getElementById('designerImagesContainer');
      container.innerHTML = '';
      
      // Display main image and any additional images
      if (designer.image) {
        container.innerHTML += `
          <div class="position-relative d-inline-block me-2 mb-2">
            <img src="${designer.image}" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;">
            <button type="button" class="btn-close position-absolute top-0 end-0" 
              style="background-color: white;" onclick="this.parentElement.remove()"></button>
          </div>
        `;
      }
      
      // Add additional images if they exist
      if (designer.images && designer.images.length > 1) {
        designer.images.slice(1).forEach(img => {
          container.innerHTML += `
            <div class="position-relative d-inline-block me-2 mb-2">
              <img src="${img}" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;">
              <button type="button" class="btn-close position-absolute top-0 end-0" 
                style="background-color: white;" onclick="this.parentElement.remove()"></button>
            </div>
          `;
        });
      }
      
      document.getElementById('designerModalLabel').textContent = 'Edit Designer';
      new bootstrap.Modal(document.getElementById('designerModal')).show();
    }
  }

  function saveDesigner() {
    const designerId = document.getElementById('designerId').value;
    const designers = JSON.parse(localStorage.getItem('designers') || '[]');
    
    // Get all images from the container
    const images = Array.from(document.getElementById('designerImagesContainer').children || [])
      .map(div => div.querySelector('img').src);
    
    const mainImage = images.length > 0 ? images[0] : '../../../img/profile.png';
    
    const designer = {
      id: designerId || `d${Date.now()}`,
      name: document.getElementById('designerName').value,
      specialty: document.getElementById('designerSpecialty').value,
      bio: document.getElementById('designerBio').value,
      image: mainImage,
      images: images,
      featured: document.getElementById('designerFeatured').checked,
      social: {
        instagram: document.getElementById('designerInstagram').value,
        pinterest: document.getElementById('designerPinterest').value,
        etsy: document.getElementById('designerEtsy').value
      }
    };
    
    if (designerId) {
      const index = designers.findIndex(d => d.id === designerId);
      if (index !== -1) {
        designers[index] = designer;
      }
    } else {
      designers.push(designer);
    }
    
    localStorage.setItem('designers', JSON.stringify(designers));
    bootstrap.Modal.getInstance(document.getElementById('designerModal')).hide();
    loadDesigners();
  }

  function deleteDesigner(id) {
    if (confirm('Are you sure you want to delete this designer? This will not delete their products.')) {
      const designers = JSON.parse(localStorage.getItem('designers') || '[]');
      const filteredDesigners = designers.filter(d => d.id !== id);
      localStorage.setItem('designers', JSON.stringify(filteredDesigners));
      loadDesigners();
    }
  }
  
  // Current filter values
  let currentFilters = {
    name: '',
    specialty: ''
  };
  
  // Filter designers function
  function filterDesigners(designers) {
    if (!designers || !designers.length) return [];
    
    return designers.filter(designer => {
      // Filter by name
      if (currentFilters.name && !designer.name.toLowerCase().includes(currentFilters.name.toLowerCase())) {
        return false;
      }
      
      // Filter by specialty
      if (currentFilters.specialty && !designer.specialty.toLowerCase().includes(currentFilters.specialty.toLowerCase())) {
        return false;
      }
      
      return true;
    });
  }
  
  // Apply filters
  function applyFilters() {
    currentFilters = {
      name: document.getElementById('filter-name').value.trim(),
      specialty: document.getElementById('filter-specialty').value.trim()
    };
    
    loadDesigners();
    
    // Show which filters are applied
    const appliedFilters = Object.entries(currentFilters)
      .filter(([_, value]) => value)
      .map(([key, _]) => key)
      .join(', ');
      
    if (appliedFilters) {
      showToast(`Filters applied: ${appliedFilters}`, 'info');
    }
  }
  
  // Reset filters
  function resetFilters() {
    document.getElementById('filter-name').value = '';
    document.getElementById('filter-specialty').value = '';
    
    currentFilters = {
      name: '',
      specialty: ''
    };
    
    loadDesigners();
    showToast('Filters cleared', 'info');
  }
  
  // Show toast notification
  function showToast(message, type = 'success') {
    const toastContainer = document.querySelector('.toast-container') || createToastContainer();
    
    const toastElement = document.createElement('div');
    toastElement.className = `toast align-items-center text-white bg-${type} border-0`;
    toastElement.setAttribute('role', 'alert');
    toastElement.setAttribute('aria-live', 'assertive');
    toastElement.setAttribute('aria-atomic', 'true');
    
    toastElement.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    
    toastContainer.appendChild(toastElement);
    
    const toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 3000 });
    toast.show();
    
    toastElement.addEventListener('hidden.bs.toast', function() {
      toastElement.remove();
    });
  }
  
  // Create toast container if doesn't exist
  function createToastContainer() {
    const container = document.createElement('div');
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    document.body.appendChild(container);
    return container;
  }
</script>
</body>
</html> 