<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website Settings - Purely Homemade</title>

  <!-- Configuration file - must be loaded first -->
  <script src="/~xzy2020c/PurelyHandmade/js/config.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

  <script>
    document.write(`
      <link rel="stylesheet" href="${CONFIG.getCssPath('navbar.css')}">
      <link rel="stylesheet" href="${CONFIG.getCssPath('global.css')}">
      <link rel="stylesheet" href="${CONFIG.getCssPath('admin.css')}">
    `);
  </script>

  <style>
    .settings-card {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      border: 1px solid #eaeaea;
    }

    .settings-header {
      background-color: #f8f9fa;
      padding: 15px;
      border-bottom: 1px solid #eaeaea;
    }

    .settings-body {
      padding: 20px;
    }
  </style>
</head>

<body>

  <div id="navbar-placeholder"></div>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/dashboard.html">
                <i class="bi bi-speedometer2 me-2"></i>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/products.html">
                <i class="bi bi-box me-2"></i>
                Products
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/categories.html">
                <i class="bi bi-tags me-2"></i>
                Categories
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/designers.html">
                <i class="bi bi-palette me-2"></i>
                Designers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/orders.html">
                <i class="bi bi-cart-check me-2"></i>
                Orders
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/users.html">
                <i class="bi bi-people me-2"></i>
                Users
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/comments.html">
                <i class="bi bi-chat-dots me-2"></i>
                Reviews
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/~xzy2020c/PurelyHandmade/views/admin/reports.html">
                <i class="bi bi-graph-up me-2"></i>
                Reports
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/~xzy2020c/PurelyHandmade/views/admin/settings.html">
                <i class="bi bi-gear me-2"></i>
                Settings
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Main content -->
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2"><i class="bi bi-gear me-2 text-primary"></i>Website Settings</h1>
          <div>
            <a href="/~xzy2020c/PurelyHandmade/views/auth/profile.html" class="btn btn-outline-secondary">
              <i class="bi bi-person me-2"></i>Back to Profile
            </a>
          </div>
        </div>

        <div class="settings-card">
          <div class="settings-header">
            <h5 class="mb-0">General Settings</h5>
          </div>
          <div class="settings-body">
            <form id="settings-form">
              <div class="mb-3">
                <label for="site-name" class="form-label">Site Name</label>
                <input type="text" class="form-control" id="site-name" placeholder="Enter site name">
              </div>
              <div class="mb-3">
                <label for="contact-email" class="form-label">Contact Email</label>
                <input type="email" class="form-control" id="contact-email" placeholder="Enter contact email">
              </div>
              <div class="mb-3">
                <label for="phone-number" class="form-label">Phone Number</label>
                <input type="text" class="form-control" id="phone-number" placeholder="Enter phone number">
              </div>
              <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <textarea class="form-control" id="address" rows="3" placeholder="Enter address"></textarea>
              </div>
              <div class="mb-3">
                <label for="facebook-link" class="form-label">Facebook Link</label>
                <input type="url" class="form-control" id="facebook-link" placeholder="Enter Facebook URL">
              </div>
              <div class="mb-3">
                <label for="twitter-link" class="form-label">Twitter Link</label>
                <input type="url" class="form-control" id="twitter-link" placeholder="Enter Twitter URL">
              </div>
              <div class="mb-3">
                <label for="instagram-link" class="form-label">Instagram Link</label>
                <input type="url" class="form-control" id="instagram-link" placeholder="Enter Instagram URL">
              </div>
              <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-secondary me-2" onclick="resetSettings()">Reset</button>
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="footer-placeholder"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Load scripts -->
  <script>
    document.write(`
    <script src="${CONFIG.getJsPath('common.js')}"><\/script>
  `);
  </script>

  <script>
    /**
     * API Service for Purely Handmade
     */
    const ApiService = {
      // åŸºç¡€API URL
      baseUrl: '/api',

      // å¤„ç†APIå“åº”
      handleResponse: async function (response) {
        console.log('ğŸ” API Response Status:', response.status, response.statusText);
        console.log('ğŸ” API Response Headers:', Object.fromEntries([...response.headers.entries()]));

        const contentType = response.headers.get('content-type');
        console.log('ğŸ” Content-Type:', contentType);

        const isJson = contentType && contentType.includes('application/json');

        // å¦‚æœçŠ¶æ€ç ä¸åœ¨2xxèŒƒå›´å†…ï¼ŒæŠ›å‡ºé”™è¯¯
        if (!response.ok) {
          let errorData;
          let responseText;

          try {
            responseText = await response.text();
            console.log('ğŸ” Error Response Text:', responseText);

            try {
              errorData = isJson ? JSON.parse(responseText) : responseText;
            } catch (jsonError) {
              console.error('ğŸ” Failed to parse JSON error response:', jsonError);
              errorData = responseText;
            }
          } catch (error) {
            console.error('ğŸ” Failed to read error response:', error);
            errorData = 'Failed to parse error response';
          }

          console.error('API Error Response:', {
            status: response.status,
            statusText: response.statusText,
            errorData: errorData
          });

          const error = new Error(
            isJson && errorData.error
              ? errorData.error
              : 'API request failed: ' + response.statusText
          );

          error.status = response.status;
          error.statusText = response.statusText;
          error.data = errorData;

          throw error;
        }

        // è§£ææˆåŠŸå“åº”
        try {
          if (isJson) {
            const jsonResponse = await response.json();
            console.log('ğŸ” Successful JSON Response:', jsonResponse);
            return jsonResponse;
          } else {
            const textResponse = await response.text();
            console.log('ğŸ” Successful Text Response:', textResponse);
            return textResponse;
          }
        } catch (error) {
          console.error('ğŸ” Failed to parse successful response:', error);
          throw new Error('Invalid response format');
        }
      },

      // å‘é€è¯·æ±‚
      request: async function (url, options = {}) {
        const fullUrl = url.startsWith('http') ? url : this.baseUrl + url;

        // é»˜è®¤é€‰é¡¹
        const defaultOptions = {
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
          },
          credentials: 'same-origin',
        };

        // æ·»åŠ æˆæƒä»¤ç‰Œ
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (token) {
          defaultOptions.headers['Authorization'] = `Bearer ${token}`;
          console.log('ğŸ”‘ Using authorization token:', token.substring(0, 10) + '...');
        } else {
          console.log('âš ï¸ No authorization token found');
        }

        // åˆå¹¶é€‰é¡¹
        const fetchOptions = {
          ...defaultOptions,
          ...options,
          headers: {
            ...defaultOptions.headers,
            ...options.headers,
          },
        };

        console.log(`ğŸ“¡ Making ${fetchOptions.method} request to: ${fullUrl}`);
        console.log('ğŸ“¡ Request options:', JSON.stringify(fetchOptions, null, 2));

        if (fetchOptions.body) {
          console.log('ğŸ“¡ Request body:', fetchOptions.body);
          try {
            // æ£€æŸ¥bodyæ˜¯å¦æ˜¯æœ‰æ•ˆçš„JSON
            const parsedBody = JSON.parse(fetchOptions.body);
            console.log('ğŸ“¡ Parsed body:', parsedBody);
          } catch (e) {
            console.error('ğŸ“¡ Body is not valid JSON:', e);
          }
        }

        try {
          console.time('ğŸ“¡ API Request Time');
          const response = await fetch(fullUrl, fetchOptions);
          console.timeEnd('ğŸ“¡ API Request Time');
          return await this.handleResponse(response);
        } catch (error) {
          console.error('âŒ API request failed:', error);
          throw error;
        }
      },

      // GETè¯·æ±‚
      get: function (url, params = {}) {
        // æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²
        const queryParams = new URLSearchParams();
        Object.keys(params).forEach(key => {
          if (params[key] !== undefined && params[key] !== null) {
            queryParams.append(key, params[key]);
          }
        });

        const queryString = queryParams.toString();
        const fullUrl = queryString ? `${url}?${queryString}` : url;

        return this.request(fullUrl, { method: 'GET' });
      },

      // POSTè¯·æ±‚
      post: function (url, data = {}) {
        return this.request(url, {
          method: 'POST',
          body: JSON.stringify(data),
        });
      },

      // PUTè¯·æ±‚
      put: function (url, data = {}) {
        return this.request(url, {
          method: 'PUT',
          body: JSON.stringify(data),
        });
      },

      // DELETEè¯·æ±‚
      delete: function (url) {
        return this.request(url, { method: 'DELETE' });
      }
    };

    /**
     * Admin API Service
     */
    const AdminApiService = {
      // è·å–è®¾ç½®
      getSettings: function (group = null) {
        let url = '/settings';
        if (group) {
          url += `?group=${encodeURIComponent(group)}`;
        }
        return ApiService.get(url);
      },

      // æ›´æ–°è®¾ç½®
      updateSettings: function (settingsData) {
        console.log('Sending settings data to server:', JSON.stringify(settingsData));
        return ApiService.post('/settings/update', settingsData);
      },

      // åˆ é™¤è®¾ç½®
      deleteSettings: function (key, group = 'general') {
        return ApiService.delete(`/settings?key=${encodeURIComponent(key)}&group=${encodeURIComponent(group)}`);
      }
    };

    function getLocalSettings() {
      const settings = JSON.parse(localStorage.getItem('settings') || '{}');
      return {
        general: {
          site_name: { value: settings.siteName || '' },
          contact_email: { value: settings.contactEmail || '' },
          phone_number: { value: settings.phoneNumber || '' },
          address: { value: settings.address || '' },
          facebook_link: { value: settings.facebookLink || '' },
          twitter_link: { value: settings.twitterLink || '' },
          instagram_link: { value: settings.instagramLink || '' }
        }
      };
    }

    function saveToLocalStorageOnly(settingsData) {
      const settings = {
        siteName: settingsData.general.site_name || '',
        contactEmail: settingsData.general.contact_email || '',
        phoneNumber: settingsData.general.phone_number || '',
        address: settingsData.general.address || '',
        facebookLink: settingsData.general.facebook_link || '',
        twitterLink: settingsData.general.twitter_link || '',
        instagramLink: settingsData.general.instagram_link || ''
      };

      localStorage.setItem('settings', JSON.stringify(settings));
      return settings;
    }

    document.addEventListener('DOMContentLoaded', function () {
      // Load navbar and footer
      loadNavbar();
      loadFooter();

      // è®¾ç½®ç›¸å…³æŒ‰é’®
      setupSettingsHandlers();

      // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
      checkAdminPermissions();
    });

    function setupSettingsHandlers() {
      console.log('ğŸ”§ Setting up settings handlers');

      // SaveæŒ‰é’®
      const saveButton = document.querySelector('button[onclick="saveSettings()"]');
      if (saveButton) {
        console.log('ğŸ”§ Found Save Changes button, attaching event listener');
        saveButton.addEventListener('click', function (e) {
          console.log('ğŸ”§ Save button clicked via event listener');
          saveSettings();
        });
      } else {
        console.warn('âš ï¸ Save Changes button not found in the DOM');
      }

      // ResetæŒ‰é’®
      const resetButton = document.querySelector('button[onclick="resetSettings()"]');
      if (resetButton) {
        console.log('ğŸ”§ Found Reset button, attaching event listener');
        resetButton.addEventListener('click', function (e) {
          console.log('ğŸ”§ Reset button clicked via event listener');
          resetSettings();
        });
      } else {
        console.warn('âš ï¸ Reset button not found in the DOM');
      }

      // ç¦»çº¿æ¨¡å¼åˆ‡æ¢
      const offlineSwitch = document.createElement('div');
      offlineSwitch.className = 'form-check form-switch mt-3';
      offlineSwitch.innerHTML = `
      <input class="form-check-input" type="checkbox" id="offline-mode-switch">
      <label class="form-check-label" for="offline-mode-switch">ç¦»çº¿æ¨¡å¼ (ä»…ä½¿ç”¨æœ¬åœ°å­˜å‚¨)</label>
    `;

      const formActions = document.querySelector('.d-flex.justify-content-end');
      if (formActions) {
        formActions.parentNode.insertBefore(offlineSwitch, formActions);

        // æ£€æŸ¥æ˜¯å¦å·²å¯ç”¨ç¦»çº¿æ¨¡å¼
        const isOffline = localStorage.getItem('settings_offline_mode') === 'true';
        document.getElementById('offline-mode-switch').checked = isOffline;

        // æ·»åŠ åˆ‡æ¢äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('offline-mode-switch').addEventListener('change', function (e) {
          localStorage.setItem('settings_offline_mode', e.target.checked);
          console.log(`ğŸ”§ ç¦»çº¿æ¨¡å¼å·²${e.target.checked ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
          showToast(`ç¦»çº¿æ¨¡å¼å·²${e.target.checked ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'info');
        });
      }
    }

    function checkAdminPermissions() {
      // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
      const token = localStorage.getItem('authToken');
      console.log('ğŸ” æ£€æŸ¥ç®¡ç†å‘˜æƒé™ - Token:', token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');

      if (!token) {
        // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
        console.log('âŒ æœªæ‰¾åˆ°è®¤è¯ä»¤ç‰Œï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢');
        window.location.href = '/~xzy2020c/PurelyHandmade/auth/login.html?redirect=admin';
        return;
      }

      // è°ƒç”¨APIéªŒè¯ç”¨æˆ·æƒé™
      console.log('ğŸ“¡ å‘é€APIè¯·æ±‚: /auth/profile');
      ApiService.get('/auth/profile')
        .then(response => {
          console.log('âœ… æ”¶åˆ°profileå“åº”:', response);
          if (!response.success || !response.data.isAdmin) {
            // ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
            console.log('âŒ ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼ŒisAdmin =', response.data?.isAdmin);
            showToast('You do not have permission to access this area', 'danger');
            setTimeout(() => {
              window.location.href = '/~xzy2020c/PurelyHandmade/index.html';
            }, 2000);
          } else {
            // åŠ è½½è®¾ç½®æ•°æ®
            console.log('âœ… ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼ŒåŠ è½½è®¾ç½®æ•°æ®');
            loadSettings();
          }
        })
        .catch(error => {
          console.error('âŒ æ£€æŸ¥ç®¡ç†å‘˜æƒé™å‡ºé”™:', error);
          // éªŒè¯å¤±è´¥ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
          showToast('Authentication error. Please login again.', 'danger');
          setTimeout(() => {
            window.location.href = '/~xzy2020c/PurelyHandmade/auth/login.html?redirect=admin';
          }, 2000);
        });
    }

    function loadSettings() {
      // æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
      showToast('Loading settings...', 'info');

      // ç›´æ¥ä»æœ¬åœ°å­˜å‚¨åŠ è½½
      loadSettingsFromLocalStorage();
      showToast('Settings loaded from local storage', 'success');
    }

    // è¾…åŠ©å‡½æ•° - ä»è®¾ç½®å¯¹è±¡ä¸­è·å–å€¼
    function getSettingValue(settingsGroup, key, defaultValue = '') {
      if (!settingsGroup || !settingsGroup[key]) {
        return defaultValue;
      }

      // å¤„ç†ä¸åŒçš„APIå“åº”æ ¼å¼
      if (typeof settingsGroup[key] === 'object' && settingsGroup[key].value !== undefined) {
        return settingsGroup[key].value;
      }

      return settingsGroup[key];
    }

    function loadSettingsFromLocalStorage() {
      const settings = JSON.parse(localStorage.getItem('settings') || '{}');
      document.getElementById('site-name').value = settings.siteName || '';
      document.getElementById('contact-email').value = settings.contactEmail || '';
      document.getElementById('phone-number').value = settings.phoneNumber || '';
      document.getElementById('address').value = settings.address || '';
      document.getElementById('facebook-link').value = settings.facebookLink || '';
      document.getElementById('twitter-link').value = settings.twitterLink || '';
      document.getElementById('instagram-link').value = settings.instagramLink || '';
    }

    function saveSettings() {
      console.log('ğŸ’¾ Starting saveSettings function');
      // æ˜¾ç¤ºä¿å­˜ä¸­çŠ¶æ€
      showToast('Saving settings...', 'info');

      // è·å–è¡¨å•å€¼ - ä½¿ç”¨æ›´ç®€å•çš„æ ¼å¼
      const settingsData = {
        general: {
          site_name: document.getElementById('site-name').value.trim(),
          contact_email: document.getElementById('contact-email').value.trim(),
          phone_number: document.getElementById('phone-number').value.trim(),
          address: document.getElementById('address').value.trim(),
          facebook_link: document.getElementById('facebook-link').value.trim(),
          twitter_link: document.getElementById('twitter-link').value.trim(),
          instagram_link: document.getElementById('instagram-link').value.trim()
        }
      };

      console.log('ğŸ’¾ Form data collected:', settingsData);

      // å…ˆä¿å­˜åˆ°localStorage
      const localSettings = {
        siteName: settingsData.general.site_name,
        contactEmail: settingsData.general.contact_email,
        phoneNumber: settingsData.general.phone_number,
        address: settingsData.general.address,
        facebookLink: settingsData.general.facebook_link,
        twitterLink: settingsData.general.twitter_link,
        instagramLink: settingsData.general.instagram_link
      };
      localStorage.setItem('settings', JSON.stringify(localSettings));
      console.log('ğŸ’¾ Saved to localStorage:', localSettings);

      // æ£€æŸ¥æ˜¯å¦å¤„äºç¦»çº¿æ¨¡å¼
      const isOfflineMode = localStorage.getItem('settings_offline_mode') === 'true';

      if (isOfflineMode) {
        console.log('ğŸ’¾ Running in offline mode, skipping API save');
        showToast('Settings saved to local storage (offline mode)', 'success');
        return;
      }

      // å°è¯•ä¿å­˜åˆ°APIï¼ˆåå°ä¿å­˜ï¼Œå³ä½¿å¤±è´¥ä¹Ÿä¸å½±å“ç”¨æˆ·ä½“éªŒï¼‰
      try {
        console.log('ğŸ’¾ Attempting to save to API...');
        showToast('Saving to server...', 'info');

        AdminApiService.updateSettings(settingsData)
          .then(response => {
            console.log('ğŸ’¾ API response received:', response);
            if (response && response.success) {
              console.log('âœ… Settings saved to API');
              showToast('Settings saved to server successfully', 'success');
            } else {
              console.warn('âš ï¸ API returned error:', response);
              showToast('Saved to local storage only', 'warning');
            }
          })
          .catch(error => {
            console.error('âŒ API Error, but settings saved to local storage:', error);
            console.log('âŒ Error name:', error.name);
            console.log('âŒ Error message:', error.message);
            console.log('âŒ Error stack:', error.stack);
            if (error.data) {
              console.log('âŒ Error data:', error.data);
            }

            showToast('Settings saved locally only - Server error', 'warning');

            // å¦‚æœå› æœåŠ¡å™¨é—®é¢˜ï¼Œå»ºè®®ç”¨æˆ·å¯ç”¨ç¦»çº¿æ¨¡å¼
            if (error.status >= 500) {
              setTimeout(() => {
                if (confirm('æœåŠ¡å™¨è¿æ¥é—®é¢˜ã€‚æ˜¯å¦å¯ç”¨ç¦»çº¿æ¨¡å¼ï¼Ÿ')) {
                  document.getElementById('offline-mode-switch').checked = true;
                  localStorage.setItem('settings_offline_mode', 'true');
                  showToast('ç¦»çº¿æ¨¡å¼å·²å¯ç”¨', 'info');
                }
              }, 1000);
            }
          });
      } catch (error) {
        console.error('âŒ Exception when saving to API, but settings saved to local storage:', error);
        console.log('âŒ Error name:', error.name);
        console.log('âŒ Error message:', error.message);
        console.log('âŒ Error stack:', error.stack);

        showToast('Settings saved locally only', 'warning');
      }
    }

    function resetSettings() {
      if (confirm('Are you sure you want to reset all settings to their default values?')) {
        // æ˜¾ç¤ºé‡ç½®ä¸­çŠ¶æ€
        showToast('Resetting settings...', 'info');

        // ç›´æ¥ä»localStorageä¸­åˆ é™¤è®¾ç½®
        localStorage.removeItem('settings');

        // é‡ç½®è¡¨å•
        document.getElementById('site-name').value = '';
        document.getElementById('contact-email').value = '';
        document.getElementById('phone-number').value = '';
        document.getElementById('address').value = '';
        document.getElementById('facebook-link').value = '';
        document.getElementById('twitter-link').value = '';
        document.getElementById('instagram-link').value = '';

        showToast('Settings reset to default', 'success');

        // å°è¯•åœ¨APIä¸­é‡ç½®è®¾ç½®ï¼ˆåå°å¤„ç†ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼‰
        try {
          // å‡†å¤‡ç©ºè®¾ç½®
          const emptySettings = {
            general: {
              site_name: '',
              contact_email: '',
              phone_number: '',
              address: '',
              facebook_link: '',
              twitter_link: '',
              instagram_link: ''
            }
          };

          // å°è¯•æ›´æ–°åˆ°API
          AdminApiService.updateSettings(emptySettings)
            .then(response => {
              if (response && response.success) {
                console.log('Settings also reset on the server');
              }
            })
            .catch(error => {
              console.error('API Error when resetting, but local settings reset successfully:', error);
            });
        } catch (error) {
          console.error('Exception when resetting on API, but local settings reset successfully:', error);
        }
      }
    }

    function showToast(message, type = 'success') {
      // ç®€å•çš„toastå®ç°ï¼Œä»…ç”¨äºå±•ç¤º
      const toast = document.createElement('div');
      toast.className = `toast-notification toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.classList.add('show');
      }, 100);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }
  </script>
</body>

</html>