<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comment Management - Purely Homemade</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/src/client/css/global.css" rel="stylesheet">
  <link href="/src/client/css/style.css" rel="stylesheet">
  <link href="/src/client/css/navbar.css" rel="stylesheet">
  <link href="/src/client/css/admin.css" rel="stylesheet">
  
  <style>
    .review-card {
      border-radius: 10px;
      border: 1px solid #eaeaea;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .review-header {
      background-color: #f8f9fa;
      padding: 15px;
      border-bottom: 1px solid #eaeaea;
    }
    
    .review-body {
      padding: 20px;
    }
    
    .review-footer {
      background-color: #f8f9fa;
      padding: 10px 15px;
      border-top: 1px solid #eaeaea;
    }
    
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #eaeaea;
    }
    
    .rating-stars {
      color: #ffc107;
      font-size: 1.2rem;
    }
    
    .status-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .status-pending {
      background-color: #f7c653;
      color: #856404;
    }
    
    .status-approved {
      background-color: #8fc2a0;
      color: #155724;
    }
    
    .status-rejected {
      background-color: #f8aaaa;
      color: #721c24;
    }
    
    .filter-section {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #e9ecef;
    }
    
    .review-product-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 5px;
      border: 1px solid #eaeaea;
    }
    
    .review-stats-card {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid #e9ecef;
    }
    
    .review-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .review-stat-icon {
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: #5a8c70;
    }
    
    .review-stat-value {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .review-stat-label {
      font-size: 0.85rem;
      color: #6c757d;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .reply-box {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<div id="navbar-placeholder"></div>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="bi bi-speedometer2 me-2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="products.html">
              <i class="bi bi-box me-2"></i>
              Products
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="categories.html">
              <i class="bi bi-tags me-2"></i>
              Categories
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="designers.html">
              <i class="bi bi-palette me-2"></i>
              Designers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="orders.html">
              <i class="bi bi-cart-check me-2"></i>
              Orders
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="users.html">
              <i class="bi bi-people me-2"></i>
              Users
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="comments.html">
              <i class="bi bi-chat-dots me-2"></i>
              Reviews
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="reports.html">
              <i class="bi bi-graph-up me-2"></i>
              Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="settings.html">
              <i class="bi bi-gear me-2"></i>
              Settings
            </a>
          </li>
        </ul>
      </div>
    </nav>
    
    <!-- Main content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2"><i class="bi bi-chat-square-text me-2 text-primary"></i>Comment Management</h1>
        <div>
          <a href="/src/client/views/auth/profile.html" class="btn btn-outline-secondary">
            <i class="bi bi-person me-2"></i>Back to Profile
          </a>
        </div>
      </div>

      <!-- Review Stats -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="review-stat">
            <div class="review-stat-icon">
              <i class="bi bi-chat-left-text"></i>
            </div>
            <div class="review-stat-value" id="total-reviews">0</div>
            <div class="review-stat-label">Total Reviews</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="review-stat">
            <div class="review-stat-icon">
              <i class="bi bi-clock"></i>
            </div>
            <div class="review-stat-value" id="pending-reviews">0</div>
            <div class="review-stat-label">Pending</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="review-stat">
            <div class="review-stat-icon">
              <i class="bi bi-check-circle"></i>
            </div>
            <div class="review-stat-value" id="approved-reviews">0</div>
            <div class="review-stat-label">Approved</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="review-stat">
            <div class="review-stat-icon">
              <i class="bi bi-star-fill"></i>
            </div>
            <div class="review-stat-value" id="avg-rating">0.0</div>
            <div class="review-stat-label">Avg. Rating</div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section mb-4">
        <div class="row g-3">
          <div class="col-md-3">
            <label for="filter-status" class="form-label">Status</label>
            <select class="form-select" id="filter-status">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="filter-rating" class="form-label">Min Rating</label>
            <select class="form-select" id="filter-rating">
              <option value="">All Ratings</option>
              <option value="5">5 Stars</option>
              <option value="4">4+ Stars</option>
              <option value="3">3+ Stars</option>
              <option value="2">2+ Stars</option>
              <option value="1">1+ Stars</option>
            </select>
          </div>
          <div class="col-md-3">
            <label for="filter-product" class="form-label">Product</label>
            <select class="form-select" id="filter-product">
              <option value="">All Products</option>
              <!-- Products will be loaded dynamically -->
            </select>
          </div>
          <div class="col-md-3">
            <label for="filter-search" class="form-label">Search</label>
            <input type="text" class="form-control" id="filter-search" placeholder="Search in reviews...">
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-12 d-flex justify-content-end">
            <button class="btn btn-secondary me-2" onclick="resetFilters()">
              <i class="bi bi-x-circle me-2"></i>Clear Filters
            </button>
            <button class="btn btn-primary" onclick="applyFilters()">
              <i class="bi bi-funnel me-2"></i>Apply Filters
            </button>
          </div>
        </div>
      </div>

      <div id="reviews-container" class="mb-4">
        <!-- Reviews will be loaded dynamically -->
      </div>
      
      <div id="no-reviews-message" class="text-center py-5 d-none">
        <div class="empty-state-icon mx-auto mb-3">
          <i class="bi bi-chat-left-text" style="font-size: 3rem; color: #ccc;"></i>
        </div>
        <p class="text-muted mb-3">No reviews found</p>
      </div>
      
      <!-- Reply Modal -->
      <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="replyModalLabel">Reply to Review</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="reply-review-id">
              <div class="form-group mb-3">
                <label for="reply-text" class="form-label">Your Reply</label>
                <textarea class="form-control" id="reply-text" rows="4" placeholder="Write your reply here..."></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="submitReply()">Submit Reply</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<div id="footer-placeholder"></div>

<div class="toast-container position-fixed top-0 end-0 p-3"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ç›´æ¥åœ¨é¡µé¢ä¸­å†…è”å®šä¹‰å…³é”®æœåŠ¡ï¼Œé¿å…åŠ è½½é—®é¢˜ -->
<script>
/**
 * API Service for Purely Handmade
 * æä¾›ç»Ÿä¸€çš„APIè®¿é—®å±‚ï¼Œå¤„ç†æ‰€æœ‰ä¸æœåŠ¡å™¨çš„é€šä¿¡
 */
const ApiService = {
  // åŸºç¡€API URL
  baseUrl: '/api',
  
  // è·å–æˆæƒä»¤ç‰Œ
  getAuthToken: function() {
    return localStorage.getItem('authToken');
  },
  
  // è·å–å¸¦æœ‰æˆæƒä¿¡æ¯çš„è¯·æ±‚å¤´
  getAuthHeaders: function() {
    const token = this.getAuthToken();
    return token ? {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    } : {
      'Content-Type': 'application/json',
      'Accept': 'application/json'
    };
  },
  
  // å¤„ç†APIå“åº”
  handleResponse: async function(response) {
    const contentType = response.headers.get('content-type');
    const isJson = contentType && contentType.includes('application/json');
    
    // å¦‚æœçŠ¶æ€ç ä¸åœ¨2xxèŒƒå›´å†…ï¼ŒæŠ›å‡ºé”™è¯¯
    if (!response.ok) {
      let errorData;
      
      try {
        errorData = isJson ? await response.json() : await response.text();
      } catch (error) {
        errorData = 'Failed to parse error response';
      }
      
      const error = new Error(
        isJson && errorData.error 
          ? errorData.error 
          : 'API request failed'
      );
      
      error.status = response.status;
      error.statusText = response.statusText;
      error.data = errorData;
      
      throw error;
    }
    
    // è§£ææˆåŠŸå“åº”
    return isJson ? response.json() : response.text();
  },
  
  // å‘é€è¯·æ±‚
  request: async function(url, options = {}) {
    const fullUrl = url.startsWith('http') ? url : this.baseUrl + url;
    
    // é»˜è®¤é€‰é¡¹
    const defaultOptions = {
      headers: this.getAuthHeaders(),
      credentials: 'same-origin',
    };
    
    // åˆå¹¶é€‰é¡¹
    const fetchOptions = {
      ...defaultOptions,
      ...options,
      headers: {
        ...defaultOptions.headers,
        ...options.headers,
      },
    };
    
    // è°ƒè¯•æ—¥å¿—
    console.log(`ğŸš€ å‘é€APIè¯·æ±‚: ${options.method || 'GET'} ${fullUrl}`);
    console.log('ğŸ”‘ è¯·æ±‚å¤´:', JSON.stringify(fetchOptions.headers));
    
    try {
      const response = await fetch(fullUrl, fetchOptions);
      console.log(`ğŸ“¥ æ”¶åˆ°å“åº”: ${response.status} ${response.statusText}`);
      return await this.handleResponse(response);
    } catch (error) {
      console.error('âŒ APIè¯·æ±‚å¤±è´¥:', error);
      throw error;
    }
  },
  
  // GETè¯·æ±‚
  get: function(url, params = {}) {
    // æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²
    const queryParams = new URLSearchParams();
    Object.keys(params).forEach(key => {
      if (params[key] !== undefined && params[key] !== null) {
        queryParams.append(key, params[key]);
      }
    });
    
    const queryString = queryParams.toString();
    const fullUrl = queryString ? `${url}?${queryString}` : url;
    
    return this.request(fullUrl, { method: 'GET' });
  },
  
  // POSTè¯·æ±‚
  post: function(url, data = {}) {
    return this.request(url, {
      method: 'POST',
      body: JSON.stringify(data),
    });
  },
  
  // PUTè¯·æ±‚
  put: function(url, data = {}) {
    return this.request(url, {
      method: 'PUT',
      body: JSON.stringify(data),
    });
  },
  
  // DELETEè¯·æ±‚
  delete: function(url) {
    return this.request(url, { method: 'DELETE' });
  }
};

/**
 * Admin API Service for Purely Handmade
 * æä¾›ç®¡ç†å‘˜APIè®¿é—®å±‚ï¼Œå¤„ç†ä¸æœåŠ¡å™¨çš„ç®¡ç†åŠŸèƒ½é€šä¿¡
 */
const AdminApiService = {
  // è·å–æ‰€æœ‰è¯„è®º/è¯„ä»·
  getAllReviews: function() {
    return ApiService.get('/reviews');
  },
  
  // æ›´æ–°è¯„è®ºçŠ¶æ€
  updateReviewStatus: function(reviewId, status) {
    return ApiService.put('/reviews/update', {
      id: reviewId,
      status: status
    });
  },
  
  // åˆ é™¤è¯„è®º
  deleteReview: function(reviewId) {
    return ApiService.delete(`/reviews?id=${reviewId}`);
  },
  
  // è·å–æ‰€æœ‰äº§å“
  getAllProducts: function() {
    return ApiService.get('/products');
  },
  
  // è·å–æ‰€æœ‰ç”¨æˆ·
  getAllUsers: function() {
    return ApiService.get('/auth/profile?all=1');
  }
};
</script>

<script src="/src/client/js/data-service.js"></script>
<script src="/src/client/js/ui-helpers.js"></script>
<script src="/src/client/js/common.js"></script>
<script>
  // ç»Ÿä¸€å­˜å‚¨è¯„è®ºæ•°æ®çš„é”®å
  const REVIEWS_STORAGE_KEY = 'reviews';
  
  // å½“å‰è¿‡æ»¤å™¨çŠ¶æ€
  let currentFilters = {
    status: '',
    rating: '',
    productId: '',
    search: ''
  };
  
  // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
  document.addEventListener('DOMContentLoaded', function() {
    console.log('è¯„è®ºç®¡ç†é¡µé¢åŠ è½½ä¸­...');
    
    // åˆå§‹åŒ–æˆæƒ
    initApiAuth();
    
    // åŠ è½½å¯¼èˆªæ å’Œé¡µè„š
    loadNavbar();
    loadFooter();
    
    // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
    checkAdminPermissions();
    
    // è®¾ç½®æœç´¢æ¡†å›è½¦äº‹ä»¶
    document.getElementById('filter-search').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        applyFilters();
      }
    });
  });
  
  // åˆå§‹åŒ–APIæˆæƒ
  function initApiAuth() {
    console.log('åˆå§‹åŒ–APIæˆæƒ');
    
    // æ£€æŸ¥æ˜¯å¦æœ‰æˆæƒä»¤ç‰Œ
    const token = localStorage.getItem('authToken');
    console.log('å½“å‰æˆæƒä»¤ç‰Œ:', token);
    
    // å¦‚æœæ²¡æœ‰ä»¤ç‰Œï¼Œåˆ›å»ºä¸€ä¸ª
    if (!token) {
      console.log('è®¾ç½®é»˜è®¤æˆæƒä»¤ç‰Œ');
      localStorage.setItem('authToken', 'valid-admin-token');
      
      // è®¾ç½®å½“å‰ç”¨æˆ·ä¿¡æ¯
      const currentUser = {
        id: 1,
        username: 'admin',
        isAdmin: true
      };
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      console.log('å·²è®¾ç½®é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·:', currentUser);
    }
  }
  
  /**
   * åˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ
   */
  function initReviewSystem() {
    console.log('åˆå§‹åŒ–è¯„è®ºç³»ç»Ÿ...');
    
    // 1. é¦–å…ˆåˆå¹¶å’Œä¿®å¤è¯„è®ºæ•°æ®
    unifyReviewData();
    
    // 2. åŠ è½½äº§å“ä¸‹æ‹‰åˆ—è¡¨
    loadProductsForFilter();
    
    // 3. åŠ è½½è¯„è®ºæ•°æ®
    loadReviews();
    
    // 4. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateReviewStats();
    
    console.log('è¯„è®ºç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
  }
  
  /**
   * ç»Ÿä¸€è¯„è®ºæ•°æ®ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
   */
  function unifyReviewData() {
    console.log('æ­£åœ¨ç»Ÿä¸€è¯„è®ºæ•°æ®...');
    
    // ä»å¯èƒ½çš„å­˜å‚¨ä½ç½®è·å–è¯„è®ºæ•°æ®
    const reviewsData = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    const commentsData = JSON.parse(localStorage.getItem('comments') || '[]');
    const productReviewsData = JSON.parse(localStorage.getItem('productReviews') || '[]');
    
    console.log(`æ‰¾åˆ°è¯„è®ºæ•°æ®: reviews=${reviewsData.length}, comments=${commentsData.length}, productReviews=${productReviewsData.length}`);
    
    // åˆå¹¶æ‰€æœ‰è¯„è®ºæ•°æ®ï¼ˆå»é‡ï¼‰
    const allReviews = [...reviewsData];
    const reviewIds = new Set(reviewsData.map(r => r.id));
    
    // æ·»åŠ commentsæ•°æ®ä¸­ä¸é‡å¤çš„è¯„è®º
    commentsData.forEach(comment => {
      if (!reviewIds.has(comment.id)) {
        allReviews.push(comment);
        reviewIds.add(comment.id);
      }
    });
    
    // æ·»åŠ productReviewsæ•°æ®ä¸­ä¸é‡å¤çš„è¯„è®º
    productReviewsData.forEach(review => {
      if (!reviewIds.has(review.id)) {
        allReviews.push(review);
        reviewIds.add(review.id);
      }
    });
    
    // ç¡®ä¿æ‰€æœ‰è¯„è®ºéƒ½æœ‰å¿…è¦çš„å­—æ®µ
    const normalizedReviews = allReviews.map(normalizeReviewObject);
    
    // ä¿å­˜ç»Ÿä¸€çš„è¯„è®ºæ•°æ®åˆ°ä¸»é”®
    localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(normalizedReviews));
    
    // åŒæ­¥åˆ°å…¶ä»–é”®ä»¥ç¡®ä¿å…¼å®¹æ€§
    localStorage.setItem('comments', JSON.stringify(normalizedReviews));
    
    console.log(`ç»Ÿä¸€åçš„è¯„è®ºæ•°æ®: ${normalizedReviews.length}æ¡`);
    
    // å¦‚æœæ²¡æœ‰è¯„è®ºæ•°æ®ï¼Œè‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®
    if (normalizedReviews.length === 0) {
      createTestReviews();
    }
  }
  
  /**
   * æ ‡å‡†åŒ–è¯„è®ºå¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰å¿…è¦å­—æ®µéƒ½å­˜åœ¨
   */
  function normalizeReviewObject(review) {
    // åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œé¿å…ä¿®æ”¹åŸå§‹å¯¹è±¡
    const normalized = { ...review };
    
    // ç¡®ä¿IDæ˜¯å­—ç¬¦ä¸²ç±»å‹
    normalized.id = String(normalized.id || Date.now());
    
    // ç¡®ä¿productIdæ˜¯å­—ç¬¦ä¸²ç±»å‹
    normalized.productId = String(normalized.productId || '');
    
    // ç¡®ä¿userIdæ˜¯å­—ç¬¦ä¸²ç±»å‹
    normalized.userId = String(normalized.userId || '');
    
    // ç¡®ä¿è¯„åˆ†æ˜¯æ•°å­—
    normalized.rating = parseInt(normalized.rating || 0);
    
    // æ ‡å‡†åŒ–å†…å®¹å­—æ®µ (æœ‰äº›å¯èƒ½ç”¨contentï¼Œæœ‰äº›ç”¨comment)
    normalized.content = normalized.content || normalized.comment || '';
    
    // åˆ é™¤å¯èƒ½å­˜åœ¨çš„commentå­—æ®µï¼Œç»Ÿä¸€ä½¿ç”¨content
    delete normalized.comment;
    
    // ç¡®ä¿æ ‡é¢˜å­—æ®µå­˜åœ¨
    normalized.title = normalized.title || 'è¯„è®º';
    
    // ç¡®ä¿çŠ¶æ€å­—æ®µå­˜åœ¨ä¸”æœ‰æ•ˆ
    normalized.status = ['approved', 'rejected', 'pending'].includes(normalized.status) 
      ? normalized.status 
      : 'pending';
    
    // ç¡®ä¿æ—¥æœŸå­—æ®µå­˜åœ¨
    const now = new Date().toISOString();
    normalized.createdAt = normalized.createdAt || normalized.date || now;
    normalized.updatedAt = normalized.updatedAt || now;
    
    // åˆ é™¤å¯èƒ½å­˜åœ¨çš„dateå­—æ®µï¼Œç»Ÿä¸€ä½¿ç”¨createdAt
    delete normalized.date;
    
    return normalized;
  }
  
  /**
   * åŠ è½½äº§å“ä¸‹æ‹‰åˆ—è¡¨
   */
  function loadProductsForFilter() {
    const products = JSON.parse(localStorage.getItem('products') || '[]');
    const productSelect = document.getElementById('filter-product');
    
    console.log(`åŠ è½½äº§å“ä¸‹æ‹‰åˆ—è¡¨ï¼Œæ‰¾åˆ°${products.length}ä¸ªäº§å“`);
    
    // æ¸…é™¤ç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"All Products"é€‰é¡¹ï¼‰
    while (productSelect.options.length > 1) {
      productSelect.remove(1);
    }
    
    // æŒ‰åç§°æ’åºäº§å“
    products.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
    
    // æ·»åŠ äº§å“é€‰é¡¹
    products.forEach(product => {
      const option = document.createElement('option');
      option.value = product.id;
      option.textContent = product.name || 'æœªå‘½åäº§å“';
      productSelect.appendChild(option);
    });
  }
  
  /**
   * åŠ è½½è¯„è®ºæ•°æ®
   */
  function loadReviews() {
    console.log('åŠ è½½è¯„è®ºæ•°æ®...');
    
    // å°è¯•ä»APIè·å–æ•°æ®
    console.log('æ­£åœ¨å°è¯•ä»APIè·å–è¯„è®ºæ•°æ®...');
    
    AdminApiService.getAllReviews()
      .then(data => {
        console.log('ä»APIè·å–çš„æ•°æ®:', data);
        if (data && data.success && data.data && Array.isArray(data.data)) {
          console.log(`æˆåŠŸä»APIè·å–${data.data.length}æ¡è¯„è®º`);
          // å°†APIæ•°æ®ä¿å­˜åˆ°localStorage
          const reviews = data.data;
          localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(reviews));
          
          // æ¸²æŸ“è¯„è®ºåˆ—è¡¨
          renderReviews(reviews);
          updateReviewStats();
          return;
        } else {
          console.log('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œå›é€€åˆ°æœ¬åœ°å­˜å‚¨');
        }
        
        // å¦‚æœAPIè¯·æ±‚å¤±è´¥ï¼Œå›é€€åˆ°ä»localStorageè·å–
        loadReviewsFromLocalStorage();
      })
      .catch(error => {
        console.error('ä»APIè·å–è¯„è®ºå¤±è´¥:', error);
        console.log('å›é€€åˆ°æœ¬åœ°å­˜å‚¨');
        loadReviewsFromLocalStorage();
      });
  }
  
  /**
   * ä»localStorageåŠ è½½è¯„è®ºæ•°æ®
   */
  function loadReviewsFromLocalStorage() {
    // è·å–è¯„è®ºæ•°æ®
    let reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    
    console.log(`ä»æœ¬åœ°å­˜å‚¨æ‰¾åˆ°${reviews.length}æ¡è¯„è®º`);
    
    // åº”ç”¨è¿‡æ»¤å™¨
    const filteredReviews = filterReviews(reviews);
    
    console.log(`è¿‡æ»¤åå‰©ä½™${filteredReviews.length}æ¡è¯„è®º`);
    
    // æ¸²æŸ“è¯„è®ºåˆ—è¡¨
    renderReviews(filteredReviews);
  }
  
  /**
   * æ ¹æ®è¿‡æ»¤æ¡ä»¶è¿‡æ»¤è¯„è®º
   */
  function filterReviews(reviews) {
    console.log('åº”ç”¨è¿‡æ»¤æ¡ä»¶:', currentFilters);
    
    return reviews.filter(review => {
      // çŠ¶æ€è¿‡æ»¤
      if (currentFilters.status && review.status !== currentFilters.status) {
        return false;
      }
      
      // è¯„åˆ†è¿‡æ»¤
      if (currentFilters.rating && review.rating < parseInt(currentFilters.rating)) {
        return false;
      }
      
      // äº§å“è¿‡æ»¤ - ç¡®ä¿IDç±»å‹ä¸€è‡´
      if (currentFilters.productId) {
        const reviewProductId = String(review.productId);
        const filterProductId = String(currentFilters.productId);
        if (reviewProductId !== filterProductId) {
          return false;
        }
      }
      
      // æœç´¢è¯è¿‡æ»¤
      if (currentFilters.search) {
        const searchTerm = currentFilters.search.toLowerCase();
        const titleMatch = review.title && review.title.toLowerCase().includes(searchTerm);
        const contentMatch = review.content && review.content.toLowerCase().includes(searchTerm);
        
        if (!titleMatch && !contentMatch) {
          return false;
        }
      }
      
      return true;
    });
  }
  
  /**
   * æ¸²æŸ“è¯„è®ºåˆ—è¡¨
   */
  function renderReviews(reviews) {
    const reviewsContainer = document.getElementById('reviews-container');
    const noReviewsMessage = document.getElementById('no-reviews-message');
    
    // æ¸…ç©ºç°æœ‰å†…å®¹
    reviewsContainer.innerHTML = '';
    
    if (reviews.length === 0) {
      // æ˜¾ç¤ºæ— è¯„è®ºä¿¡æ¯
      noReviewsMessage.classList.remove('d-none');
      console.log('æ²¡æœ‰è¯„è®ºå¯æ˜¾ç¤º');
    } else {
      // éšè—æ— è¯„è®ºä¿¡æ¯
      noReviewsMessage.classList.add('d-none');
      
      // è·å–äº§å“å’Œç”¨æˆ·æ•°æ®ç”¨äºæ˜¾ç¤º
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰
      reviews.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      // æ¸²æŸ“æ¯æ¡è¯„è®º
      reviews.forEach(review => {
        renderReviewCard(review, products, users, reviewsContainer);
      });
    }
  }
  
  /**
   * æ¸²æŸ“å•ä¸ªè¯„è®ºå¡ç‰‡
   */
  function renderReviewCard(review, products, users, container) {
    // æŸ¥æ‰¾äº§å“ä¿¡æ¯ - ç¡®ä¿IDç±»å‹ä¸€è‡´
    const productIdStr = String(review.productId);
    const product = products.find(p => String(p.id) === productIdStr) || { 
      name: 'æœªçŸ¥äº§å“', 
      image: '../../../img/product-placeholder.jpg' 
    };
    
    // æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯ - ç¡®ä¿IDç±»å‹ä¸€è‡´
    const userIdStr = String(review.userId);
    const user = users.find(u => String(u.id) === userIdStr) || { 
      name: 'åŒ¿åç”¨æˆ·',
      firstName: '',
      lastName: 'åŒ¿åç”¨æˆ·',
      avatar: '../../../img/profile.png' 
    };
    
    // ç”¨æˆ·æ˜¾ç¤ºåç§°ä¼˜å…ˆçº§ï¼šname > firstName+lastName > é»˜è®¤å€¼
    const userName = user.name || `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'åŒ¿åç”¨æˆ·';
    
    // åˆ›å»ºè¯„è®ºå¡ç‰‡
    const reviewCard = document.createElement('div');
    reviewCard.className = 'review-card';
    
    // ç”ŸæˆçŠ¶æ€å¾½ç« 
    let statusBadge;
    switch(review.status) {
      case 'approved':
        statusBadge = '<span class="status-badge status-approved">å·²æ‰¹å‡†</span>';
        break;
      case 'rejected':
        statusBadge = '<span class="status-badge status-rejected">å·²æ‹’ç»</span>';
        break;
      default:
        statusBadge = '<span class="status-badge status-pending">å¾…å®¡æ ¸</span>';
    }
    
    // ç”Ÿæˆæ˜Ÿçº§è¯„åˆ†HTML
    const rating = parseInt(review.rating) || 0;
    let starsHtml = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= rating) {
        starsHtml += '<i class="bi bi-star-fill"></i> ';
      } else {
        starsHtml += '<i class="bi bi-star"></i> ';
      }
    }
    
    // è®¾ç½®è¯„è®ºå¡ç‰‡HTML
    reviewCard.innerHTML = `
      <div class="review-header">
        <div class="d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <img src="${product.image || '../../../img/product-placeholder.jpg'}" class="review-product-image" alt="${product.name}">
            </div>
            <div>
              <h5 class="mb-0">${product.name}</h5>
              <div class="text-muted small">${new Date(review.createdAt).toLocaleDateString()}</div>
            </div>
          </div>
          <div>
            ${statusBadge}
          </div>
        </div>
      </div>
      <div class="review-body">
        <div class="d-flex align-items-center mb-3">
          <img src="${user.avatar || '../../../img/profile.png'}" alt="${userName}" class="user-avatar me-3">
          <div>
            <h6 class="mb-0">${userName}</h6>
            <div class="rating-stars">${starsHtml}</div>
          </div>
        </div>
        <div class="mb-3">
          <h6>${review.title || 'è¯„è®º'}</h6>
          <p>${review.content || 'æ²¡æœ‰æä¾›è¯„è®ºå†…å®¹ã€‚'}</p>
        </div>
        ${review.reply ? `
          <div class="reply-box">
            <h6><i class="bi bi-reply me-2"></i>ç®¡ç†å‘˜å›å¤</h6>
            <p class="mb-0">${review.reply}</p>
          </div>
        ` : ''}
      </div>
      <div class="review-footer">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <span class="me-3">è¯„è®ºID: ${String(review.id).slice(0, 8)}</span>
          </div>
          <div>
            ${review.status === 'pending' ? `
              <button class="btn btn-sm btn-success me-2" onclick="updateReviewStatus('${review.id}', 'approved')">
                <i class="bi bi-check-circle me-1"></i>æ‰¹å‡†
              </button>
              <button class="btn btn-sm btn-danger me-2" onclick="updateReviewStatus('${review.id}', 'rejected')">
                <i class="bi bi-x-circle me-1"></i>æ‹’ç»
              </button>
            ` : ''}
            ${!review.reply ? `
              <button class="btn btn-sm btn-primary me-2" onclick="openReplyModal('${review.id}')">
                <i class="bi bi-reply me-1"></i>å›å¤
              </button>
            ` : `
              <button class="btn btn-sm btn-outline-primary me-2" onclick="openReplyModal('${review.id}')">
                <i class="bi bi-pencil me-1"></i>ç¼–è¾‘å›å¤
              </button>
            `}
            <button class="btn btn-sm btn-danger" onclick="deleteReview('${review.id}')">
              <i class="bi bi-trash me-1"></i>åˆ é™¤
            </button>
          </div>
        </div>
      </div>
    `;
    
    // æ·»åŠ åˆ°å®¹å™¨
    container.appendChild(reviewCard);
  }
  
  /**
   * æ›´æ–°è¯„è®ºç»Ÿè®¡ä¿¡æ¯
   */
  function updateReviewStats() {
    // è·å–è¯„è®ºæ•°æ®
    const reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    
    // æ€»è¯„è®ºæ•°
    document.getElementById('total-reviews').textContent = reviews.length;
    
    // å¾…å®¡æ ¸è¯„è®ºæ•°
    const pendingReviews = reviews.filter(review => review.status === 'pending').length;
    document.getElementById('pending-reviews').textContent = pendingReviews;
    
    // å·²æ‰¹å‡†è¯„è®ºæ•°
    const approvedReviews = reviews.filter(review => review.status === 'approved').length;
    document.getElementById('approved-reviews').textContent = approvedReviews;
    
    // è®¡ç®—å¹³å‡è¯„åˆ†ï¼ˆä»…è€ƒè™‘å·²æ‰¹å‡†çš„è¯„è®ºï¼‰
    let totalRating = 0;
    let ratingCount = 0;
    
    reviews.forEach(review => {
      if (review.status === 'approved' && review.rating) {
        totalRating += parseInt(review.rating);
        ratingCount++;
      }
    });
    
    const avgRating = ratingCount > 0 ? (totalRating / ratingCount).toFixed(1) : '0.0';
    document.getElementById('avg-rating').textContent = avgRating;
  }
  
  /**
   * åº”ç”¨è¿‡æ»¤å™¨
   */
  function applyFilters() {
    // è·å–è¿‡æ»¤å™¨å€¼
    currentFilters = {
      status: document.getElementById('filter-status').value,
      rating: document.getElementById('filter-rating').value,
      productId: document.getElementById('filter-product').value,
      search: document.getElementById('filter-search').value.trim()
    };
    
    // é‡æ–°åŠ è½½è¯„è®º
    loadReviews();
  }
  
  /**
   * é‡ç½®è¿‡æ»¤å™¨
   */
  function resetFilters() {
    // é‡ç½®è¡¨å•æ§ä»¶
    document.getElementById('filter-status').value = '';
    document.getElementById('filter-rating').value = '';
    document.getElementById('filter-product').value = '';
    document.getElementById('filter-search').value = '';
    
    // é‡ç½®è¿‡æ»¤å™¨å¯¹è±¡
    currentFilters = {
      status: '',
      rating: '',
      productId: '',
      search: ''
    };
    
    // é‡æ–°åŠ è½½è¯„è®º
    loadReviews();
  }
  
  /**
   * æ›´æ–°è¯„è®ºçŠ¶æ€
   */
  function updateReviewStatus(reviewId, newStatus) {
    showLoading();
    
    AdminApiService.updateReviewStatus(reviewId, newStatus)
      .then(response => {
        if (response.success) {
          showToast(`è¯„è®ºçŠ¶æ€å·²æ›´æ–°ä¸º ${newStatus}`, 'success');
          loadReviews(); // é‡æ–°åŠ è½½è¯„è®ºæ•°æ®
        } else {
          throw new Error(response.message || 'æ›´æ–°è¯„è®ºçŠ¶æ€å¤±è´¥');
        }
      })
      .catch(error => {
        console.error('æ›´æ–°è¯„è®ºçŠ¶æ€å¤±è´¥:', error);
        showToast('æ›´æ–°è¯„è®ºçŠ¶æ€å¤±è´¥: ' + error.message, 'error');
        
        // å›é€€åˆ°æœ¬åœ°å­˜å‚¨
        updateReviewStatusLocalOnly(reviewId, newStatus);
      })
      .finally(() => {
        hideLoading();
      });
  }
  
  /**
   * æœ¬åœ°å­˜å‚¨çš„è¯„è®ºçŠ¶æ€æ›´æ–°ï¼ˆAPIå¤±è´¥åçš„å›é€€æ–¹æ¡ˆï¼‰
   */
  function updateReviewStatusLocalOnly(reviewId, newStatus) {
    let reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    
    const reviewIndex = reviews.findIndex(review => review.id == reviewId);
    if (reviewIndex !== -1) {
      reviews[reviewIndex].status = newStatus;
      localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(reviews));
      renderReviews(reviews);
      updateReviewStats();
      showToast('è¯„è®ºçŠ¶æ€å·²åœ¨æœ¬åœ°æ›´æ–°', 'warning');
    }
  }
  
  /**
   * æ‰“å¼€å›å¤æ¨¡æ€æ¡†
   */
  function openReplyModal(reviewId) {
    document.getElementById('reply-review-id').value = reviewId;
    
    // è·å–è¯„è®ºæ•°æ®
    const reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    const review = reviews.find(r => r.id === reviewId);
    
    if (review && review.reply) {
      document.getElementById('reply-text').value = review.reply;
    } else {
      document.getElementById('reply-text').value = '';
    }
    
    // æ˜¾ç¤ºæ¨¡æ€æ¡†
    const replyModal = new bootstrap.Modal(document.getElementById('replyModal'));
    replyModal.show();
  }
  
  /**
   * æäº¤å›å¤
   */
  function submitReply() {
    const reviewId = document.getElementById('reply-review-id').value;
    const replyText = document.getElementById('reply-text').value.trim();
    
    if (!replyText) {
      showToast('å›å¤å†…å®¹ä¸èƒ½ä¸ºç©º', 'warning');
      return;
    }
    
    console.log(`æäº¤å¯¹è¯„è®º ${reviewId} çš„å›å¤`);
    
    // ä½¿ç”¨APIæœåŠ¡æäº¤å›å¤
    AdminApiService.updateReviewStatus(reviewId, 'approved')
      .then(response => {
        console.log('å›å¤æäº¤æˆåŠŸ:', response);
        showToast('å›å¤å·²å‘å¸ƒ', 'success');
        
        // å…³é—­æ¨¡æ€æ¡†
        bootstrap.Modal.getInstance(document.getElementById('replyModal')).hide();
        
        // åœ¨æœ¬åœ°æ›´æ–°è¯„è®ºçš„å›å¤å†…å®¹
        submitReplyLocal(reviewId, replyText);
        
        // é‡æ–°åŠ è½½è¯„è®º
        loadReviews();
      })
      .catch(error => {
        console.error('æäº¤å›å¤å¤±è´¥:', error);
        showToast('æäº¤å›å¤å¤±è´¥', 'danger');
        
        // åœ¨APIå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œå°è¯•æœ¬åœ°æäº¤
        submitReplyLocal(reviewId, replyText);
      });
  }
  
  /**
   * åœ¨æœ¬åœ°æäº¤å›å¤ï¼ˆAPIå¤±è´¥çš„åå¤‡æ–¹æ¡ˆï¼‰
   */
  function submitReplyLocal(reviewId, replyText) {
    // è·å–è¯„è®ºæ•°æ®
    const reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    
    // æŸ¥æ‰¾è¯„è®º
    const reviewIndex = reviews.findIndex(r => r.id === reviewId);
    
    if (reviewIndex === -1) {
      showToast('æ‰¾ä¸åˆ°è¯„è®º', 'danger');
      return;
    }
    
    // æ·»åŠ å›å¤
    reviews[reviewIndex].reply = replyText;
    reviews[reviewIndex].updatedAt = new Date().toISOString();
    
    // ä¿å­˜åˆ°ä¸»é”®
    localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(reviews));
    
    // ä¿å­˜åˆ°commentsé”®ä»¥ç¡®ä¿å…¼å®¹æ€§
    localStorage.setItem('comments', JSON.stringify(reviews));
    
    // å…³é—­æ¨¡æ€æ¡†
    bootstrap.Modal.getInstance(document.getElementById('replyModal')).hide();
    
    // é‡æ–°åŠ è½½è¯„è®º
    loadReviews();
    
    showToast('å›å¤å·²æœ¬åœ°ä¿å­˜', 'warning');
  }
  
  /**
   * åˆ é™¤è¯„è®º
   */
  function deleteReview(reviewId) {
    if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
      return;
    }
    
    showLoading();
    
    AdminApiService.deleteReview(reviewId)
      .then(response => {
        if (response.success) {
          showToast('è¯„è®ºå·²æˆåŠŸåˆ é™¤', 'success');
          loadReviews(); // é‡æ–°åŠ è½½è¯„è®ºæ•°æ®
        } else {
          throw new Error(response.message || 'åˆ é™¤è¯„è®ºå¤±è´¥');
        }
      })
      .catch(error => {
        console.error('åˆ é™¤è¯„è®ºå¤±è´¥:', error);
        showToast('åˆ é™¤è¯„è®ºå¤±è´¥: ' + error.message, 'error');
        
        // å›é€€åˆ°æœ¬åœ°å­˜å‚¨
        deleteReviewLocalOnly(reviewId);
      })
      .finally(() => {
        hideLoading();
      });
  }
  
  /**
   * æœ¬åœ°å­˜å‚¨çš„è¯„è®ºåˆ é™¤ï¼ˆAPIå¤±è´¥åçš„å›é€€æ–¹æ¡ˆï¼‰
   */
  function deleteReviewLocalOnly(reviewId) {
    let reviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '[]');
    
    const filteredReviews = reviews.filter(review => review.id != reviewId);
    if (filteredReviews.length < reviews.length) {
      localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(filteredReviews));
      renderReviews(filteredReviews);
      updateReviewStats();
      showToast('è¯„è®ºå·²åœ¨æœ¬åœ°åˆ é™¤', 'warning');
    }
  }
  
  /**
   * æ£€æŸ¥ç®¡ç†å‘˜æƒé™
   */
  function checkAdminPermissions() {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜
    const token = localStorage.getItem('authToken');
    console.log('ğŸ” æ£€æŸ¥ç®¡ç†å‘˜æƒé™ - Token:', token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
    
    if (!token) {
      // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
      console.log('âŒ æœªæ‰¾åˆ°è®¤è¯ä»¤ç‰Œï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢');
      window.location.href = '/src/client/views/auth/login.html?redirect=admin';
      return;
    }
    
    // è°ƒç”¨APIéªŒè¯ç”¨æˆ·æƒé™
    console.log('ğŸ“¡ å‘é€APIè¯·æ±‚: /auth/profile');
    ApiService.get('/auth/profile')
      .then(response => {
        console.log('âœ… æ”¶åˆ°profileå“åº”:', response);
        if (!response.success || !response.data.isAdmin) {
          // ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
          console.log('âŒ ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼ŒisAdmin =', response.data?.isAdmin);
          showToast('You do not have permission to access this area', 'danger');
          setTimeout(() => {
            window.location.href = '/src/client/views/index.html';
          }, 2000);
        } else {
          // åŠ è½½è¯„è®ºæ•°æ®
          console.log('âœ… ç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼ŒåŠ è½½è¯„è®ºæ•°æ®');
          loadReviews();
        }
      })
      .catch(error => {
        console.error('âŒ æ£€æŸ¥ç®¡ç†å‘˜æƒé™å‡ºé”™:', error);
        // éªŒè¯å¤±è´¥ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
        showToast('Authentication error. Please login again.', 'danger');
        setTimeout(() => {
          window.location.href = '/src/client/views/auth/login.html?redirect=admin';
        }, 2000);
      });
  }
  
  /**
   * æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
   */
  function showToast(message, type = 'primary') {
    const toastContainer = document.querySelector('.toast-container');
    
    const toastElement = document.createElement('div');
    toastElement.className = `toast align-items-center text-white bg-${type} border-0`;
    toastElement.setAttribute('role', 'alert');
    toastElement.setAttribute('aria-live', 'assertive');
    toastElement.setAttribute('aria-atomic', 'true');
    
    toastElement.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    
    toastContainer.appendChild(toastElement);
    
    const toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 3000 });
    toast.show();
    
    toastElement.addEventListener('hidden.bs.toast', function() {
      toastElement.remove();
    });
  }
  
  /**
   * åˆ›å»ºæµ‹è¯•è¯„è®ºæ•°æ®
   */
  function createTestReviews() {
    console.log('åˆ›å»ºæµ‹è¯•è¯„è®ºæ•°æ®...');
    
    // è·å–äº§å“æ•°æ®
    const products = JSON.parse(localStorage.getItem('products') || '[]');
    if (products.length === 0) {
      console.error('æ²¡æœ‰äº§å“æ•°æ®ï¼Œæ— æ³•åˆ›å»ºæµ‹è¯•è¯„è®º');
      showToast('æ— æ³•åˆ›å»ºæµ‹è¯•è¯„è®ºï¼šæ‰¾ä¸åˆ°äº§å“æ•°æ®', 'danger');
      return;
    }
    
    // è·å–ç”¨æˆ·æ•°æ®
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    if (users.length === 0) {
      console.error('æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œæ— æ³•åˆ›å»ºæµ‹è¯•è¯„è®º');
      showToast('æ— æ³•åˆ›å»ºæµ‹è¯•è¯„è®ºï¼šæ‰¾ä¸åˆ°ç”¨æˆ·æ•°æ®', 'danger');
      return;
    }
    
    // åˆ›å»ºæµ‹è¯•è¯„è®º
    const testReviews = [
      {
        id: Date.now().toString() + '1',
        productId: String(products[0].id),
        userId: String(users[0].id),
        rating: 5,
        title: 'éå¸¸æ»¡æ„çš„è´­ç‰©ä½“éªŒ',
        content: 'äº§å“è´¨é‡å¾ˆå¥½ï¼Œåšå·¥ç²¾ç»†ï¼Œå¼ºçƒˆæ¨èè´­ä¹°ã€‚é€è´§é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼ŒåŒ…è£…å®Œå¥½æ— æŸã€‚',
        status: 'approved',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      },
      {
        id: Date.now().toString() + '2',
        productId: String(products[0].id),
        userId: String(users[0].id),
        rating: 4,
        title: 'æ€§ä»·æ¯”é«˜',
        content: 'æ€»ä½“ä¸é”™ï¼Œä½†ä»·æ ¼ç¨é«˜ã€‚äº§å“è´¨é‡ç¬¦åˆé¢„æœŸï¼Œå®¢æœæ€åº¦ä¹Ÿå¾ˆå¥½ã€‚',
        status: 'approved',
        createdAt: new Date(Date.now() - 86400000).toISOString(), // 1å¤©å‰
        updatedAt: new Date(Date.now() - 86400000).toISOString()
      },
      {
        id: Date.now().toString() + '3',
        productId: String(products.length > 1 ? products[1].id : products[0].id),
        userId: String(users.length > 1 ? users[1].id : users[0].id),
        rating: 3,
        title: 'ä¸€èˆ¬èˆ¬',
        content: 'äº§å“è¿˜è¡Œï¼Œæ²¡æœ‰å›¾ç‰‡ä¸Šçœ‹èµ·æ¥é‚£ä¹ˆå¥½ã€‚å‘è´§æœ‰ç‚¹æ…¢ï¼ŒåŒ…è£…ä¸€èˆ¬ã€‚',
        status: 'pending',
        createdAt: new Date(Date.now() - 172800000).toISOString(), // 2å¤©å‰
        updatedAt: new Date(Date.now() - 172800000).toISOString()
      },
      {
        id: Date.now().toString() + '4',
        productId: String(products.length > 1 ? products[1].id : products[0].id),
        userId: String(users.length > 1 ? users[1].id : users[0].id),
        rating: 2,
        title: 'ä¸å¤ªæ»¡æ„',
        content: 'äº§å“æœ‰ç‘•ç–µï¼Œä¸æ˜¯å¾ˆæ»¡æ„ã€‚å¸Œæœ›å•†å®¶èƒ½å¤Ÿæ”¹è¿›ã€‚',
        status: 'rejected',
        createdAt: new Date(Date.now() - 259200000).toISOString(), // 3å¤©å‰
        updatedAt: new Date(Date.now() - 259200000).toISOString()
      }
    ];
    
    // ä¿å­˜åˆ°localStorage
    localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(testReviews));
    
    // ä¸ºäº†å…¼å®¹æ€§ï¼ŒåŒæ—¶ä¿å­˜åˆ°commentsé”®
    localStorage.setItem('comments', JSON.stringify(testReviews));
    
    console.log(`å·²åˆ›å»º${testReviews.length}æ¡æµ‹è¯•è¯„è®º`);
    showToast(`å·²åˆ›å»º${testReviews.length}æ¡æµ‹è¯•è¯„è®º`, 'success');
    
    // é‡æ–°åŠ è½½è¯„è®º
    loadReviews();
    updateReviewStats();
  }
</script>
</body>
</html> 