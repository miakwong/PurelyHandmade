<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>调试控制台 - Purely Homemade</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #eae2d6;
      --secondary-color: #e1d7c6;
      --accent-color: #867666;
      --text-color: #5e4b3e;
      --border-color: #bfb1a3;
      --shadow: 0 4px 6px rgba(94, 75, 62, 0.1);
      --border-radius: 8px;
      --primary-light: rgba(134, 118, 102, 0.25);
      --text-muted: #6c757d;
      --bg-light: #f8f9fa;
      --success-color: #5a8c70;
      --danger-color: #a95e5e;
      --button-color: #867666;
      --button-hover: #6f6255;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text-color);
      background-color: #f9f7f4;
    }
    
    .navbar-custom {
      background-color: var(--primary-color);
    }
    
    .card {
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      border: none;
      margin-bottom: 20px;
    }
    
    .card-header {
      background-color: var(--primary-color);
      color: var(--text-color);
      font-weight: bold;
      border-bottom: none;
    }
    
    .btn-primary {
      background-color: var(--button-color);
      border-color: var(--button-color);
    }
    
    .btn-primary:hover {
      background-color: var(--button-hover);
      border-color: var(--button-hover);
    }
    
    .btn-outline-primary {
      color: var(--button-color);
      border-color: var(--button-color);
    }
    
    .btn-outline-primary:hover {
      background-color: var(--button-color);
      border-color: var(--button-color);
      color: white;
    }
    
    .debug-data {
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9rem;
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
    }

    .code-block {
      background-color: #f1f1f1;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
      font-family: monospace;
    }

    .badge-custom {
      background-color: var(--accent-color);
      color: white;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-card {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .user-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .user-card.active {
      border: 2px solid var(--accent-color);
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container">
      <a class="navbar-brand" href="/index.html">
        <span class="fw-bold">纯手工坊</span> <span class="badge badge-custom">调试控制台</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="/index.html">
              <i class="bi bi-house-fill"></i> 返回首页
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/src/client/views/auth/profile.html">
              <i class="bi bi-person-fill"></i> 个人资料
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/src/client/views/admin/dashboard.html">
              <i class="bi bi-speedometer2"></i> 管理后台
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container my-5">
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="mb-3">网站调试控制台</h1>
        <p class="lead">这个页面用于测试和管理网站功能，生成测试数据，以及快速切换用户角色。</p>
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle-fill"></i> 注意：此页面仅供开发和测试使用，包含的功能可能会修改或删除本地存储中的数据。
        </div>
      </div>
    </div>

    <!-- Status Dashboard -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-info-circle-fill me-2"></i>系统状态</span>
            <button class="btn btn-sm btn-outline-primary" onclick="refreshStatus()">
              <i class="bi bi-arrow-clockwise"></i> 刷新
            </button>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <div class="border rounded p-3 text-center">
                  <h6 class="text-muted mb-1">当前用户</h6>
                  <div class="d-flex align-items-center justify-content-center">
                    <img id="current-user-avatar" src="/src/client/img/profile.png" class="user-avatar me-2" alt="User">
                    <h5 id="current-user-name" class="mb-0">未登录</h5>
                  </div>
                  <span id="current-user-role" class="badge bg-secondary mt-2">无角色</span>
                </div>
              </div>
              <div class="col-md-3">
                <div class="border rounded p-3 text-center">
                  <h6 class="text-muted mb-1">用户数量</h6>
                  <h4 id="users-count" class="mb-0">0</h4>
                </div>
              </div>
              <div class="col-md-3">
                <div class="border rounded p-3 text-center">
                  <h6 class="text-muted mb-1">地址数量</h6>
                  <h4 id="addresses-count" class="mb-0">0</h4>
                </div>
              </div>
              <div class="col-md-3">
                <div class="border rounded p-3 text-center">
                  <h6 class="text-muted mb-1">LocalStorage大小</h6>
                  <h4 id="storage-size" class="mb-0">0 KB</h4>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- User Management -->
      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <i class="bi bi-people-fill me-2"></i>用户管理
          </div>
          <div class="card-body">
            <div class="mb-3">
              <h5>创建测试用户</h5>
              <div class="row g-2">
                <div class="col-md-6">
                  <button class="btn btn-outline-primary w-100" onclick="createNormalUser()">
                    <i class="bi bi-person me-1"></i> 创建普通用户
                  </button>
                </div>
                <div class="col-md-6">
                  <button class="btn btn-outline-primary w-100" onclick="createAdminUser()">
                    <i class="bi bi-person-badge me-1"></i> 创建管理员用户
                  </button>
                </div>
              </div>
            </div>
            
            <hr>
            
            <h5 class="mb-3">用户列表</h5>
            <div id="users-container" class="mb-3">
              <div class="text-center py-3 text-muted">
                <i class="bi bi-people"></i> 暂无用户
              </div>
            </div>
            
            <button class="btn btn-outline-danger w-100" onclick="clearUsers()">
              <i class="bi bi-trash me-1"></i> 清除所有用户数据
            </button>
          </div>
        </div>
      </div>
      
      <!-- Data Viewer -->
      <div class="col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-database-fill me-2"></i>数据浏览器</span>
            <div>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="refreshData()">
                <i class="bi bi-arrow-clockwise"></i> 刷新
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="clearAllData()">
                <i class="bi bi-trash"></i> 清除所有数据
              </button>
            </div>
          </div>
          <div class="card-body">
            <ul class="nav nav-tabs" id="dataTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-data" type="button">
                  用户数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-data" type="button">
                  产品数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories-data" type="button">
                  分类数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews-data" type="button">
                  评论数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders-data" type="button">
                  订单数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="designers-tab" data-bs-toggle="tab" data-bs-target="#designers-data" type="button">
                  设计师数据
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="current-tab" data-bs-toggle="tab" data-bs-target="#current-data" type="button">
                  当前用户
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="custom-tab" data-bs-toggle="tab" data-bs-target="#custom-data" type="button">
                  自定义查询
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all-data" type="button">
                  所有数据
                </button>
              </li>
            </ul>
            
            <div class="tab-content mt-3" id="dataTabsContent">
              <div class="tab-pane fade show active" id="users-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="users-count-badge">0</span></span>
                  <span class="text-muted small">键名: users</span>
                </div>
                <pre class="debug-data" id="users-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="products-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="products-count-badge">0</span></span>
                  <span class="text-muted small">键名: products</span>
                </div>
                <pre class="debug-data" id="products-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="categories-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="categories-count-badge">0</span></span>
                  <span class="text-muted small">键名: categories</span>
                </div>
                <pre class="debug-data" id="categories-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="reviews-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="reviews-count-badge">0</span></span>
                  <span class="text-muted small">键名: reviews, comments</span>
                </div>
                <pre class="debug-data" id="reviews-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="orders-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="orders-count-badge">0</span></span>
                  <span class="text-muted small">键名: orders</span>
                </div>
                <pre class="debug-data" id="orders-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="designers-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">数据条数: <span id="designers-count-badge">0</span></span>
                  <span class="text-muted small">键名: designers</span>
                </div>
                <pre class="debug-data" id="designers-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="current-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">当前用户信息</span>
                  <span class="text-muted small">键名: currentUser</span>
                </div>
                <pre class="debug-data" id="current-user-json">暂无数据</pre>
              </div>
              <div class="tab-pane fade" id="custom-data" role="tabpanel">
                <div class="mb-3">
                  <label for="storage-key-select" class="form-label">选择数据键名:</label>
                  <div class="d-flex">
                    <select class="form-select me-2" id="storage-key-select">
                      <option value="">请选择...</option>
                      <!-- 动态填充 -->
                    </select>
                    <button class="btn btn-primary" onclick="loadCustomData()">加载数据</button>
                  </div>
                </div>
                <div id="custom-data-info" class="mb-2 d-flex justify-content-between align-items-center d-none">
                  <span class="badge bg-secondary">
                    <span id="custom-data-type">未知类型</span>: 
                    <span id="custom-data-count-badge">0</span>
                  </span>
                  <span class="text-muted small">键名: <span id="custom-key-name">无</span></span>
                </div>
                <pre class="debug-data" id="custom-data-json">请从下拉菜单中选择一个数据键</pre>
              </div>
              <div class="tab-pane fade" id="all-data" role="tabpanel">
                <div class="mb-2 d-flex justify-content-between align-items-center">
                  <span class="badge bg-secondary">LocalStorage 键值: <span id="keys-count-badge">0</span></span>
                  <span class="text-muted small">所有本地存储数据</span>
                </div>
                <pre class="debug-data" id="all-storage-json">暂无数据</pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Actions & Tools -->
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header">
            <i class="bi bi-tools me-2"></i>测试工具
          </div>
          <div class="card-body">
            <h5 class="mb-3">地址管理</h5>
            <div class="row g-2 mb-3">
              <div class="col-md-6">
                <button class="btn btn-outline-primary w-100" onclick="addRandomAddress()">
                  <i class="bi bi-geo-alt me-1"></i> 添加随机地址
                </button>
              </div>
              <div class="col-md-6">
                <button class="btn btn-outline-primary w-100" onclick="clearAddresses()">
                  <i class="bi bi-trash me-1"></i> 清除所有地址
                </button>
              </div>
            </div>
            
            <hr>
            
            <h5 class="mb-3">测试数据生成</h5>
            <div class="row g-2 mb-3">
              <div class="col-md-4">
                <button class="btn btn-outline-primary w-100" onclick="createTestProducts()">
                  <i class="bi bi-box-seam me-1"></i> 生成测试产品
                </button>
              </div>
              <div class="col-md-4">
                <button class="btn btn-outline-primary w-100" onclick="createTestCategories()">
                  <i class="bi bi-tag me-1"></i> 生成测试分类
                </button>
              </div>
              <div class="col-md-4">
                <button class="btn btn-outline-primary w-100" onclick="createTestReviews()">
                  <i class="bi bi-chat-text me-1"></i> 生成测试评论
                </button>
              </div>
            </div>
            <div class="row g-2 mb-3">
              <div class="col-md-4">
                <button class="btn btn-outline-primary w-100" onclick="createTestOrders()">
                  <i class="bi bi-bag me-1"></i> 生成测试订单
                </button>
              </div>
              <div class="col-md-4">
                <button class="btn btn-outline-primary w-100" onclick="createTestDesigners()">
                  <i class="bi bi-person-badge me-1"></i> 生成测试设计师
                </button>
              </div>
              <div class="col-md-4">
                <button class="btn btn-outline-danger w-100" onclick="initAllTestData()">
                  <i class="bi bi-database-fill me-1"></i> 生成所有测试数据
                </button>
              </div>
            </div>
            
            <hr>
            
            <h5 class="mb-3">应用导航</h5>
            <div class="row g-2">
              <div class="col-md-4">
                <a href="/src/client/views/auth/profile.html" class="btn btn-outline-primary w-100">
                  <i class="bi bi-person me-1"></i> 个人资料
                </a>
              </div>
              <div class="col-md-4">
                <a href="/src/client/views/admin/dashboard.html" class="btn btn-outline-primary w-100">
                  <i class="bi bi-speedometer2 me-1"></i> 管理后台
                </a>
              </div>
              <div class="col-md-4">
                <a href="/index.html" class="btn btn-outline-primary w-100">
                  <i class="bi bi-house me-1"></i> 返回主页
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 mb-4">
        <div class="card">
          <div class="card-header">
            <i class="bi bi-code-slash me-2"></i>开发者工具
          </div>
          <div class="card-body">
            <h5 class="mb-3">用户数据操作</h5>
            <div class="mb-3">
              <label class="form-label">导入/导出数据</label>
              <div class="row g-2">
                <div class="col-md-6">
                  <button class="btn btn-outline-primary w-100" onclick="exportData()">
                    <i class="bi bi-download me-1"></i> 导出所有数据
                  </button>
                </div>
                <div class="col-md-6">
                  <button class="btn btn-outline-primary w-100" onclick="document.getElementById('import-data').click()">
                    <i class="bi bi-upload me-1"></i> 导入数据
                  </button>
                  <input type="file" id="import-data" style="display:none" onchange="importData(this.files)">
                </div>
              </div>
            </div>
            
            <hr>
            
            <h5 class="mb-3">Console 命令参考</h5>
            <div class="code-block">
              <p class="mb-1">// 查看所有用户</p>
              <p class="mb-1">JSON.parse(localStorage.getItem('users'))</p>
              <p class="mb-1">// 查看当前用户</p>
              <p class="mb-1">JSON.parse(localStorage.getItem('currentUser'))</p>
              <p class="mb-0">// 清除所有数据</p>
              <p class="mb-0">localStorage.clear()</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="py-4 bg-light mt-5">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center">
          <p class="mb-0 text-muted">纯手工坊 调试控制台 &copy; 2023</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 页面初始化
    document.addEventListener('DOMContentLoaded', function() {
      refreshStatus();
      refreshData();
      loadUsers();
      populateStorageKeySelect();
    });
    
    // 刷新状态信息
    function refreshStatus() {
      // 显示当前用户
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (currentUser) {
        document.getElementById('current-user-name').textContent = currentUser.name || currentUser.username;
        document.getElementById('current-user-role').textContent = (currentUser.role === 'admin' || currentUser.isAdmin) ? '管理员' : '普通用户';
        document.getElementById('current-user-role').className = (currentUser.role === 'admin' || currentUser.isAdmin) 
          ? 'badge bg-danger mt-2' : 'badge bg-success mt-2';
        if (currentUser.avatar) {
          document.getElementById('current-user-avatar').src = currentUser.avatar;
        }
      } else {
        document.getElementById('current-user-name').textContent = '未登录';
        document.getElementById('current-user-role').textContent = '无角色';
        document.getElementById('current-user-role').className = 'badge bg-secondary mt-2';
        document.getElementById('current-user-avatar').src = '/src/client/img/profile.png';
      }
      
      // 统计数据
      const users = JSON.parse(localStorage.getItem('users')) || [];
      document.getElementById('users-count').textContent = users.length;
      
      // 地址数量
      let addressesCount = 0;
      users.forEach(user => {
        if (user.addresses) {
          addressesCount += user.addresses.length;
        }
      });
      if (currentUser && currentUser.addresses) {
        addressesCount += currentUser.addresses.length;
      }
      document.getElementById('addresses-count').textContent = addressesCount;
      
      // localStorage 大小
      const totalSize = calculateStorageSize();
      document.getElementById('storage-size').textContent = `${totalSize} KB`;
    }
    
    // 计算localStorage大小
    function calculateStorageSize() {
      let total = 0;
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        total += (key.length + value.length) * 2; // 2 bytes per character
      }
      return (total / 1024).toFixed(2); // Convert to KB
    }
    
    // 刷新数据显示
    function refreshData() {
      // 获取各类数据
      const usersData = JSON.parse(localStorage.getItem('users') || '[]');
      const productsData = JSON.parse(localStorage.getItem('products') || '[]');
      const categoriesData = JSON.parse(localStorage.getItem('categories') || '[]');
      const reviewsData = JSON.parse(localStorage.getItem('reviews') || '[]');
      const commentsData = JSON.parse(localStorage.getItem('comments') || '[]');
      const ordersData = JSON.parse(localStorage.getItem('orders') || '[]');
      const designersData = JSON.parse(localStorage.getItem('designers') || '[]');
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      // 更新数据展示
      document.getElementById('users-json').textContent = JSON.stringify(usersData, null, 2);
      document.getElementById('products-json').textContent = JSON.stringify(productsData, null, 2);
      document.getElementById('categories-json').textContent = JSON.stringify(categoriesData, null, 2);
      
      // 评论数据可能存在于reviews或comments中，统一显示
      const allReviews = reviewsData.length > 0 ? reviewsData : commentsData;
      document.getElementById('reviews-json').textContent = JSON.stringify(allReviews, null, 2);
      
      document.getElementById('orders-json').textContent = JSON.stringify(ordersData, null, 2);
      document.getElementById('designers-json').textContent = JSON.stringify(designersData, null, 2);
      document.getElementById('current-user-json').textContent = currentUser ? JSON.stringify(currentUser, null, 2) : '暂无当前用户';
      
      // 更新计数徽章
      document.getElementById('users-count-badge').textContent = usersData.length;
      document.getElementById('products-count-badge').textContent = productsData.length;
      document.getElementById('categories-count-badge').textContent = categoriesData.length;
      document.getElementById('reviews-count-badge').textContent = allReviews.length;
      document.getElementById('orders-count-badge').textContent = ordersData.length;
      document.getElementById('designers-count-badge').textContent = designersData.length;
      
      // 所有 localStorage 数据
      let allData = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        try {
          allData[key] = JSON.parse(localStorage.getItem(key));
        } catch (e) {
          allData[key] = localStorage.getItem(key);
        }
      }
      document.getElementById('all-storage-json').textContent = JSON.stringify(allData, null, 2);
      document.getElementById('keys-count-badge').textContent = localStorage.length;
      
      // 刷新自定义数据选择器
      populateStorageKeySelect();
    }
    
    // 填充存储键名下拉选择器
    function populateStorageKeySelect() {
      const select = document.getElementById('storage-key-select');
      const currentValue = select.value; // 保存当前选中值
      
      // 清空现有选项（保留第一个）
      while (select.options.length > 1) {
        select.remove(1);
      }
      
      // 获取所有键名并排序
      const keys = [];
      for (let i = 0; i < localStorage.length; i++) {
        keys.push(localStorage.key(i));
      }
      keys.sort();
      
      // 添加键名选项
      keys.forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        select.appendChild(option);
      });
      
      // 如果之前有选中值，尝试恢复
      if (currentValue) {
        select.value = currentValue;
      }
    }
    
    // 加载自定义键名的数据
    function loadCustomData() {
      const select = document.getElementById('storage-key-select');
      const key = select.value;
      
      if (!key) {
        document.getElementById('custom-data-json').textContent = '请从下拉菜单中选择一个数据键';
        document.getElementById('custom-data-info').classList.add('d-none');
        return;
      }
      
      const rawData = localStorage.getItem(key);
      let displayData, dataType, count = 0;
      
      try {
        // 尝试解析为JSON
        displayData = JSON.parse(rawData);
        
        // 确定数据类型和数量
        if (Array.isArray(displayData)) {
          dataType = '数组';
          count = displayData.length;
        } else if (typeof displayData === 'object' && displayData !== null) {
          dataType = '对象';
          count = Object.keys(displayData).length;
        } else {
          dataType = typeof displayData;
          count = 1;
        }
      } catch (e) {
        // 如果不是JSON，则显示原始字符串
        displayData = rawData;
        dataType = '字符串';
        count = rawData.length;
      }
      
      // 更新显示
      document.getElementById('custom-data-json').textContent = typeof displayData === 'object' 
        ? JSON.stringify(displayData, null, 2) 
        : displayData;
      
      document.getElementById('custom-data-type').textContent = dataType;
      document.getElementById('custom-data-count-badge').textContent = count;
      document.getElementById('custom-key-name').textContent = key;
      document.getElementById('custom-data-info').classList.remove('d-none');
      
      showToast(`已加载 "${key}" 数据`);
    }
    
    // 加载用户列表
    function loadUsers() {
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const container = document.getElementById('users-container');
      
      if (users.length === 0) {
        container.innerHTML = `
          <div class="text-center py-3 text-muted">
            <i class="bi bi-people"></i> 暂无用户
          </div>
        `;
        return;
      }
      
      container.innerHTML = '';
      users.forEach(user => {
        const isCurrentUser = currentUser && user.id === currentUser.id;
        const card = document.createElement('div');
        card.className = `card mb-2 user-card ${isCurrentUser ? 'active' : ''}`;
        card.onclick = function() { switchToUser(user.id); };
        
        card.innerHTML = `
          <div class="card-body p-2">
            <div class="d-flex align-items-center">
              <img src="${user.avatar || '/src/client/img/profile.png'}" class="user-avatar me-3" alt="${user.name}">
              <div>
                <h6 class="mb-0">${user.name || user.username}</h6>
                <small class="text-muted">@${user.username}</small>
                <div>
                  <span class="badge ${(user.role === 'admin' || user.isAdmin) ? 'bg-danger' : 'bg-success'}">
                    ${(user.role === 'admin' || user.isAdmin) ? '管理员' : '普通用户'}
                  </span>
                  ${isCurrentUser ? '<span class="badge bg-primary">当前用户</span>' : ''}
                </div>
              </div>
              <div class="ms-auto">
                <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${user.id}', event)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
    }
    
    // 创建普通用户
    function createNormalUser() {
      const userId = 'user_' + Math.random().toString(36).substr(2, 9);
      const username = 'user_' + Math.floor(Math.random() * 1000);
      
      const newUser = {
        id: userId,
        username: username,
        email: `${username}@example.com`,
        name: `普通用户 ${Math.floor(Math.random() * 100)}`,
        firstName: '普通',
        lastName: '用户',
        role: 'user',
        isAdmin: false,
        addresses: []
      };
      
      // 保存到用户列表
      const users = JSON.parse(localStorage.getItem('users')) || [];
      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));
      
      // 设为当前用户
      localStorage.setItem('currentUser', JSON.stringify(newUser));
      
      // 刷新页面
      refreshStatus();
      refreshData();
      loadUsers();
      showToast('普通用户创建成功');
    }
    
    // 创建管理员用户
    function createAdminUser() {
      const userId = 'admin_' + Math.random().toString(36).substr(2, 9);
      const username = 'admin_' + Math.floor(Math.random() * 1000);
      
      const newAdmin = {
        id: userId,
        username: username,
        email: `${username}@example.com`,
        name: `管理员 ${Math.floor(Math.random() * 100)}`,
        firstName: '管理员',
        lastName: '用户',
        role: 'admin',
        isAdmin: true,
        addresses: []
      };
      
      // 保存到用户列表
      const users = JSON.parse(localStorage.getItem('users')) || [];
      users.push(newAdmin);
      localStorage.setItem('users', JSON.stringify(users));
      
      // 设为当前用户
      localStorage.setItem('currentUser', JSON.stringify(newAdmin));
      
      // 刷新页面
      refreshStatus();
      refreshData();
      loadUsers();
      showToast('管理员用户创建成功');
    }
    
    // 切换到指定用户
    function switchToUser(userId) {
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const user = users.find(u => u.id === userId);
      
      if (user) {
        localStorage.setItem('currentUser', JSON.stringify(user));
        refreshStatus();
        refreshData();
        loadUsers();
        showToast(`已切换到用户: ${user.name || user.username}`);
      }
    }
    
    // 删除用户
    function deleteUser(userId, event) {
      if (event) {
        event.stopPropagation();
      }
      
      if (!confirm('确定要删除这个用户吗？')) {
        return;
      }
      
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const updatedUsers = users.filter(user => user.id !== userId);
      localStorage.setItem('users', JSON.stringify(updatedUsers));
      
      // 如果删除的是当前用户，清空当前用户
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (currentUser && currentUser.id === userId) {
        localStorage.removeItem('currentUser');
      }
      
      refreshStatus();
      refreshData();
      loadUsers();
      showToast('用户删除成功');
    }
    
    // 清除所有用户
    function clearUsers() {
      if (!confirm('确定要清除所有用户数据吗？')) {
        return;
      }
      
      localStorage.removeItem('users');
      localStorage.removeItem('currentUser');
      
      refreshStatus();
      refreshData();
      loadUsers();
      showToast('所有用户数据已清除');
    }
    
    // 添加随机地址
    function addRandomAddress() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) {
        showToast('请先选择一个用户', 'error');
        return;
      }
      
      if (!currentUser.addresses) {
        currentUser.addresses = [];
      }
      
      // 生成随机地址数据
      const cities = ['北京', '上海', '广州', '深圳', '杭州', '南京', '成都', '武汉'];
      const addressTypes = ['家庭地址', '公司地址', '学校地址', '父母家', '朋友家'];
      
      const newAddress = {
        name: addressTypes[Math.floor(Math.random() * addressTypes.length)],
        fullName: currentUser.name || `${currentUser.firstName} ${currentUser.lastName}`,
        streetAddress: `${Math.floor(Math.random() * 100) + 1}号 ${Math.floor(Math.random() * 100) + 1}单元`,
        aptSuite: `${Math.floor(Math.random() * 10) + 1}0${Math.floor(Math.random() * 10) + 1}室`,
        city: cities[Math.floor(Math.random() * cities.length)],
        state: '某省',
        zipCode: `${Math.floor(Math.random() * 900000) + 100000}`,
        country: '中国',
        phone: `1${Math.floor(Math.random() * 9) + 1}${Math.random().toString().substr(2, 9)}`,
        isDefault: currentUser.addresses.length === 0 // 如果是第一个地址，则设为默认
      };
      
      // 添加地址
      currentUser.addresses.push(newAddress);
      
      // 保存回用户数据
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      
      // 同步更新 users 数组
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const userIndex = users.findIndex(user => user.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
        localStorage.setItem('users', JSON.stringify(users));
      }
      
      refreshStatus();
      refreshData();
      showToast('已添加随机地址');
    }
    
    // 清除当前用户的所有地址
    function clearAddresses() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) {
        showToast('请先选择一个用户', 'error');
        return;
      }
      
      currentUser.addresses = [];
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      
      // 同步更新 users 数组
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const userIndex = users.findIndex(user => user.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
        localStorage.setItem('users', JSON.stringify(users));
      }
      
      refreshStatus();
      refreshData();
      showToast('已清除所有地址');
    }
    
    // 清除所有数据
    function clearAllData() {
      if (confirm('确定要清除所有本地存储数据吗？此操作不可恢复！')) {
        localStorage.clear();
        refreshStatus();
        refreshData();
        loadUsers();
        showToast('所有数据已清除');
      }
    }
    
    // 导出数据
    function exportData() {
      let exportData = {};
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        try {
          exportData[key] = JSON.parse(localStorage.getItem(key));
        } catch (e) {
          exportData[key] = localStorage.getItem(key);
        }
      }
      
      const dataStr = JSON.stringify(exportData, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileName = `purelyhomemade_data_${new Date().toISOString().split('T')[0]}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileName);
      linkElement.click();
      
      showToast('数据导出成功');
    }
    
    // 导入数据
    function importData(files) {
      if (files.length === 0) return;
      
      const file = files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (confirm('导入将覆盖当前所有数据，确定要继续吗？')) {
            // 先清除所有数据
            localStorage.clear();
            
            // 导入数据
            for (const key in data) {
              localStorage.setItem(key, JSON.stringify(data[key]));
            }
            
            refreshStatus();
            refreshData();
            loadUsers();
            showToast('数据导入成功');
          }
        } catch (error) {
          console.error('Import error:', error);
          showToast('数据格式错误，导入失败', 'error');
        }
      };
      
      reader.readAsText(file);
    }
    
    // 显示通知
    function showToast(message, type = 'success') {
      // 创建 toast 元素
      const toastContainer = document.createElement('div');
      toastContainer.className = 'position-fixed bottom-0 end-0 p-3';
      toastContainer.style.zIndex = '1050';
      
      const toastElement = document.createElement('div');
      toastElement.className = `toast align-items-center text-white bg-${type === 'error' ? 'danger' : 'success'}`;
      toastElement.setAttribute('role', 'alert');
      toastElement.setAttribute('aria-live', 'assertive');
      toastElement.setAttribute('aria-atomic', 'true');
      
      const toastContent = document.createElement('div');
      toastContent.className = 'd-flex';
      
      const toastBody = document.createElement('div');
      toastBody.className = 'toast-body';
      toastBody.textContent = message;
      
      const closeButton = document.createElement('button');
      closeButton.type = 'button';
      closeButton.className = 'btn-close btn-close-white me-2 m-auto';
      closeButton.setAttribute('data-bs-dismiss', 'toast');
      closeButton.setAttribute('aria-label', 'Close');
      
      toastContent.appendChild(toastBody);
      toastContent.appendChild(closeButton);
      toastElement.appendChild(toastContent);
      toastContainer.appendChild(toastElement);
      
      document.body.appendChild(toastContainer);
      
      const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 3000
      });
      
      toast.show();
      
      // 动画结束后删除元素
      toastElement.addEventListener('hidden.bs.toast', function() {
        document.body.removeChild(toastContainer);
      });
    }
    
    // 创建测试产品数据
    function createTestProducts() {
      // 检查是否已经有产品数据
      const existingProducts = JSON.parse(localStorage.getItem('products') || '[]');
      if (existingProducts.length > 0 && !confirm('已存在产品数据，是否继续创建?')) {
        return;
      }
      
      // 创建测试产品
      const testProducts = [
        {
          id: 'product_' + Date.now() + '_1',
          name: '手工编织羊毛围巾',
          description: '100%纯羊毛制作，保暖舒适，冬季必备。每条围巾均由手工编织，纹理独特。',
          price: 299,
          discountPrice: 249,
          stock: 20,
          categories: ['围巾', '冬季', '羊毛'],
          images: ['/src/client/img/product-1.jpg'],
          rating: 4.5,
          featured: true,
          createdAt: new Date().toISOString()
        },
        {
          id: 'product_' + Date.now() + '_2',
          name: '纯棉手绘T恤',
          description: '采用优质纯棉面料，手工绘制图案，每件作品都是独一无二的艺术品。',
          price: 199,
          discountPrice: null,
          stock: 15,
          categories: ['服装', '夏季', 'T恤'],
          images: ['/src/client/img/product-2.jpg'],
          rating: 4.2,
          featured: false,
          createdAt: new Date().toISOString()
        },
        {
          id: 'product_' + Date.now() + '_3',
          name: '手工陶瓷花瓶',
          description: '由资深陶艺师手工制作，每个花瓶都有独特的形状和纹理，是装饰家居的理想选择。',
          price: 399,
          discountPrice: 349,
          stock: 10,
          categories: ['家居', '装饰', '陶瓷'],
          images: ['/src/client/img/product-3.jpg'],
          rating: 4.8,
          featured: true,
          createdAt: new Date().toISOString()
        }
      ];
      
      // 保存到localStorage
      localStorage.setItem('products', JSON.stringify([...existingProducts, ...testProducts]));
      
      // 刷新数据显示
      refreshData();
      showToast(`已创建${testProducts.length}个测试产品`);
    }
    
    // 创建测试分类数据
    function createTestCategories() {
      const existingCategories = JSON.parse(localStorage.getItem('categories') || '[]');
      if (existingCategories.length > 0 && !confirm('已存在分类数据，是否继续创建?')) {
        return;
      }
      
      const testCategories = [
        {
          id: 'category_' + Date.now() + '_1',
          name: '服装',
          description: '手工制作的各种服装，包括T恤、围巾、帽子等',
          icon: 'bi-layers',
          products: [],
          createdAt: new Date().toISOString()
        },
        {
          id: 'category_' + Date.now() + '_2',
          name: '家居',
          description: '手工制作的家居饰品，包括花瓶、摆件、挂画等',
          icon: 'bi-house',
          products: [],
          createdAt: new Date().toISOString()
        },
        {
          id: 'category_' + Date.now() + '_3',
          name: '饰品',
          description: '手工制作的各种饰品，包括项链、手链、耳环等',
          icon: 'bi-gem',
          products: [],
          createdAt: new Date().toISOString()
        },
        {
          id: 'category_' + Date.now() + '_4',
          name: '节日礼物',
          description: '适合各种节日赠送的手工礼物',
          icon: 'bi-gift',
          products: [],
          createdAt: new Date().toISOString()
        }
      ];
      
      localStorage.setItem('categories', JSON.stringify([...existingCategories, ...testCategories]));
      
      refreshData();
      showToast(`已创建${testCategories.length}个测试分类`);
    }
    
    // 创建测试评论数据
    function createTestReviews() {
      const existingReviews = JSON.parse(localStorage.getItem('reviews') || '[]');
      const existingComments = JSON.parse(localStorage.getItem('comments') || '[]');
      
      if ((existingReviews.length > 0 || existingComments.length > 0) && !confirm('已存在评论数据，是否继续创建?')) {
        return;
      }
      
      // 获取产品和用户数据
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      if (products.length === 0) {
        showToast('请先创建产品数据', 'error');
        return;
      }
      
      if (users.length === 0) {
        showToast('请先创建用户数据', 'error');
        return;
      }
      
      const testReviews = [];
      
      // 为每个产品创建1-3个评论
      products.forEach((product, index) => {
        const reviewCount = Math.floor(Math.random() * 3) + 1;
        
        for (let i = 0; i < reviewCount; i++) {
          const user = users[Math.floor(Math.random() * users.length)];
          const rating = Math.floor(Math.random() * 3) + 3; // 3-5星
          
          testReviews.push({
            id: 'review_' + Date.now() + '_' + index + '_' + i,
            productId: product.id,
            userId: user.id,
            rating: rating,
            title: ['非常满意', '质量很好', '服务周到', '包装精美'][Math.floor(Math.random() * 4)],
            content: ['产品质量很好，与描述相符，非常满意。', 
                     '收到货很惊喜，手工制作精良，值得推荐。', 
                     '很喜欢这个产品，独特的设计让我爱不释手。',
                     '质量不错，包装也很精美，适合送礼。'][Math.floor(Math.random() * 4)],
            status: ['pending', 'approved', 'approved'][Math.floor(Math.random() * 3)],
            createdAt: new Date(Date.now() - Math.floor(Math.random() * 30) * 86400000).toISOString(), // 随机1-30天前
            updatedAt: new Date().toISOString()
          });
        }
      });
      
      // 保存到localStorage
      localStorage.setItem('reviews', JSON.stringify([...existingReviews, ...testReviews]));
      localStorage.setItem('comments', JSON.stringify([...existingComments, ...testReviews])); // 兼容
      
      refreshData();
      showToast(`已创建${testReviews.length}个测试评论`);
    }
    
    // 创建测试订单数据
    function createTestOrders() {
      const existingOrders = JSON.parse(localStorage.getItem('orders') || '[]');
      
      if (existingOrders.length > 0 && !confirm('已存在订单数据，是否继续创建?')) {
        return;
      }
      
      // 获取产品和用户数据
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      if (products.length === 0) {
        showToast('请先创建产品数据', 'error');
        return;
      }
      
      if (users.length === 0) {
        showToast('请先创建用户数据', 'error');
        return;
      }
      
      const orderStatuses = ['pending', 'processing', 'shipped', 'delivered', 'cancelled'];
      const paymentMethods = ['creditCard', 'alipay', 'wechatPay', 'bankTransfer'];
      
      const testOrders = [];
      
      // 为每个用户创建1-3个订单
      users.forEach((user, userIndex) => {
        const orderCount = Math.floor(Math.random() * 3) + 1;
        
        for (let i = 0; i < orderCount; i++) {
          // 随机选择1-3个产品
          const orderItems = [];
          const productCount = Math.floor(Math.random() * 3) + 1;
          const selectedProducts = [];
          
          while (selectedProducts.length < productCount && selectedProducts.length < products.length) {
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            if (!selectedProducts.find(p => p.id === randomProduct.id)) {
              selectedProducts.push(randomProduct);
              
              const quantity = Math.floor(Math.random() * 3) + 1;
              orderItems.push({
                productId: randomProduct.id,
                productName: randomProduct.name,
                price: randomProduct.discountPrice || randomProduct.price,
                quantity: quantity,
                subtotal: (randomProduct.discountPrice || randomProduct.price) * quantity,
                image: randomProduct.images ? randomProduct.images[0] : null
              });
            }
          }
          
          // 计算订单总价
          const totalAmount = orderItems.reduce((sum, item) => sum + item.subtotal, 0);
          const shippingFee = Math.floor(Math.random() * 3) * 10 + 10; // 10, 20, 30
          
          const orderDate = new Date(Date.now() - Math.floor(Math.random() * 30) * 86400000);
          
          testOrders.push({
            id: 'order_' + Date.now() + '_' + userIndex + '_' + i,
            userId: user.id,
            items: orderItems,
            totalAmount: totalAmount,
            shippingFee: shippingFee,
            grandTotal: totalAmount + shippingFee,
            status: orderStatuses[Math.floor(Math.random() * orderStatuses.length)],
            paymentMethod: paymentMethods[Math.floor(Math.random() * paymentMethods.length)],
            isPaid: Math.random() > 0.3, // 70%概率已支付
            shippingAddress: user.addresses && user.addresses.length > 0 ? 
              user.addresses[Math.floor(Math.random() * user.addresses.length)] : 
              { fullName: user.name, city: '某城市', streetAddress: '某街道', phone: '1234567890' },
            createdAt: orderDate.toISOString(),
            updatedAt: new Date(orderDate.getTime() + Math.floor(Math.random() * 3) * 86400000).toISOString()
          });
        }
      });
      
      localStorage.setItem('orders', JSON.stringify([...existingOrders, ...testOrders]));
      
      refreshData();
      showToast(`已创建${testOrders.length}个测试订单`);
    }
    
    // 创建测试设计师数据
    function createTestDesigners() {
      const existingDesigners = JSON.parse(localStorage.getItem('designers') || '[]');
      
      if (existingDesigners.length > 0 && !confirm('已存在设计师数据，是否继续创建?')) {
        return;
      }
      
      const testDesigners = [
        {
          id: 'designer_' + Date.now() + '_1',
          name: '张艺',
          avatar: '/src/client/img/designer1.jpg',
          specialty: '羊毛编织',
          bio: '张艺是一位拥有10年编织经验的手工艺人，专注于羊毛编织艺术创作。她的作品温暖而精致，每一件都蕴含着独特的温度与故事。',
          contactEmail: 'zhangyi@example.com',
          products: [],
          featured: true,
          createdAt: new Date().toISOString()
        },
        {
          id: 'designer_' + Date.now() + '_2',
          name: '李陶',
          avatar: '/src/client/img/designer2.jpg',
          specialty: '陶艺',
          bio: '李陶毕业于景德镇陶瓷学院，致力于将传统陶艺与现代审美相结合。他的作品既保留了传统工艺的精髓，又融入了现代设计的理念。',
          contactEmail: 'litao@example.com',
          products: [],
          featured: true,
          createdAt: new Date().toISOString()
        },
        {
          id: 'designer_' + Date.now() + '_3',
          name: '王彩',
          avatar: '/src/client/img/designer3.jpg',
          specialty: '手绘布艺',
          bio: '王彩是一位充满创意的年轻设计师，擅长在布料上进行手工绘制。她的作品色彩鲜明，充满生活气息，深受年轻人喜爱。',
          contactEmail: 'wangcai@example.com',
          products: [],
          featured: false,
          createdAt: new Date().toISOString()
        }
      ];
      
      localStorage.setItem('designers', JSON.stringify([...existingDesigners, ...testDesigners]));
      
      refreshData();
      showToast(`已创建${testDesigners.length}个测试设计师`);
    }
    
    // 初始化所有测试数据
    function initAllTestData() {
      if (!confirm('此操作将生成所有类型的测试数据，可能会覆盖现有数据。是否继续?')) {
        return;
      }
      
      // 先创建用户，再创建其他数据
      if (JSON.parse(localStorage.getItem('users') || '[]').length === 0) {
        createNormalUser();
        createAdminUser();
      }
      
      // 按顺序创建数据，保证依赖关系
      createTestCategories();
      createTestProducts();
      createTestDesigners();
      createTestReviews();
      createTestOrders();
      
      showToast('已初始化所有测试数据', 'success');
    }
  </script>
</body>
</html> 