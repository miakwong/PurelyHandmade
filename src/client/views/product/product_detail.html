<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Purely Homemade - Product Detail</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/navbar.css">
  <link rel="stylesheet" href="../../css/global.css">
  <link rel="stylesheet" href="../../css/product_detail.css">

  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Load Data Service -->
  <script src="/src/client/js/data-service.js"></script>
  <script src="/src/client/js/api-data-loader.js"></script>

</head>
<body>

<!-- Navbar Placeholder -->
<div id="navbar-placeholder"></div>

<!-- Breadcrumb -->
<div class="container mt-3">
  <nav>
    <ol class="breadcrumb" id="breadcrumb">
      <li class="breadcrumb-item"><a href="/src/client/html/index.html">Home</a></li>
      <li class="breadcrumb-item" id="breadcrumb-category-link"><a href="#">Category</a></li>
      <li class="breadcrumb-item active" id="breadcrumb-product">Item Name</li>
    </ol>
  </nav>
</div>

<!-- Product Detail Section -->
<div class="container mb-5">
  <div class="row">
    <!-- Product Images -->
    <div class="col-md-6">
      <div id="product-carousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner" id="carousel-images">
          <!-- Images loaded dynamically -->
          <div class="carousel-item active">
            <img src="/src/client/assets/placeholder.jpg" class="d-block w-100" alt="Product image">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#product-carousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#product-carousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>
      </div>
    </div>

    <!-- Product Info -->
    <div class="col-md-6">
      <div id="product-status" class="mb-2">
        <!-- Product status (in stock, low stock, etc) will be set here -->
      </div>
      <h1 id="product-title" class="mb-2">Loading product...</h1>
      <div class="rating mb-3" id="product-rating">
        <!-- Rating stars added here -->
      </div>
      
      <div id="product-price-container" class="mb-3">
        <span id="product-price" class="fw-bold fs-4"></span>
        <span id="product-original-price" class="text-decoration-line-through text-muted ms-2"></span>
      </div>

      <div class="d-flex align-items-center mb-4">
        <div class="input-group" style="width: 120px;">
          <button class="btn btn-outline-secondary" type="button" id="decrease-quantity">-</button>
          <input type="text" class="form-control text-center" id="product-quantity" value="1">
          <button class="btn btn-outline-secondary" type="button" id="increase-quantity">+</button>
        </div>
        <button class="btn btn-primary ms-3" id="add-to-cart"><i class="bi bi-cart-plus me-2"></i>Add to Cart</button>
        <button class="btn btn-outline-secondary ms-2" id="wishlist-btn"><i class="bi bi-heart"></i></button>
      </div>

      <div class="product-description mb-4" id="product-description">
        <p class="text-muted">Loading product description...</p>
      </div>

      <div class="product-meta mb-4">
        <div class="d-flex mb-2">
          <span class="text-muted me-2">Category:</span>
          <span id="product-category">Loading...</span>
        </div>
        <div class="d-flex mb-2">
          <span class="text-muted me-2">Designer:</span>
          <span id="product-designer">Loading...</span>
        </div>
        <div class="d-flex mb-2">
          <span class="text-muted me-2">Item Code:</span>
          <span id="product-code">Loading...</span>
        </div>
      </div>

      <div class="social-share mb-4">
        <span class="text-muted me-2">Share:</span>
        <a href="#" class="social-icon me-2"><i class="bi bi-facebook"></i></a>
        <a href="#" class="social-icon me-2"><i class="bi bi-twitter"></i></a>
        <a href="#" class="social-icon me-2"><i class="bi bi-pinterest"></i></a>
        <a href="#" class="social-icon me-2"><i class="bi bi-link-45deg"></i></a>
      </div>
    </div>
  </div>

  <!-- Product Tabs -->
  <div class="row mt-5">
    <div class="col-12">
      <ul class="nav nav-tabs" id="productTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Description</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">Details</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews</button>
        </li>
      </ul>
      <div class="tab-content p-4 border border-top-0 rounded-bottom" id="productTabsContent">
        <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
          <div id="full-description">
            <p class="text-muted">Loading product description...</p>
          </div>
        </div>
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
          <div id="product-details">
            <p class="text-muted">Loading product details...</p>
          </div>
        </div>
        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
          <div id="reviews-container">
            <p class="text-muted">Loading product reviews...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">You May Also Like</h3>
      <div class="row" id="related-products-container">
        <!-- Related products loaded dynamically -->
      </div>
    </div>
  </div>
</div>

<!-- Footer Placeholder -->
<div id="footer-placeholder"></div>

<!-- Toast Container for notifications -->
<div id="toast-container" class="toast-container"></div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Load navbar and footer -->
<script>
  $(function() {
    $("#navbar-placeholder").load("/src/client/assets/layout/navbar.html");
    $("#footer-placeholder").load("/src/client/assets/layout/footer.html");
  });
</script>

<script>
  // Get product ID from URL
  function getProductId() {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    return id ? parseInt(id) : null;
  }
  
  // Load product details from API
  async function loadProductDetails() {
    const productId = getProductId();
    
    if (!productId) {
      showError('Product ID not found in URL');
      return;
    }
    
    try {
      // Show loading state
      document.getElementById('product-title').textContent = 'Loading product...';
      
      // Fetch product from API
      const product = await DataService.getProductById(productId);
      
      if (!product) {
        showError('Product not found');
        return;
      }
      
      // Render product
      renderProduct(product);
      
      // Setup other page elements
      setupQuantityButtons();
      checkWishlist(productId);
      setupSocialSharing(product);
      
      // Load related products
      loadRelatedProducts(product);
      
      // Update cart count
      updateCartCount();
    } catch (error) {
      console.error('Error loading product:', error);
      showError('Failed to load product details');
    }
  }
  
  // Render product details
  function renderProduct(product) {
    // Set title
    document.getElementById('product-title').textContent = product.name || 'Unnamed Product';
    
    // Set breadcrumbs
    document.getElementById('breadcrumb-product').textContent = product.name || 'Product';
    
    const categoryLink = document.getElementById('breadcrumb-category-link');
    if (product.categoryName) {
      categoryLink.querySelector('a').href = `/src/client/views/product/products.html?category=${product.categoryId}`;
      categoryLink.querySelector('a').textContent = product.categoryName;
    } else {
      categoryLink.querySelector('a').href = `/src/client/views/product/category-list.html`;
      categoryLink.querySelector('a').textContent = 'Categories';
    }
    
    // Set images
    const carouselInner = document.getElementById('carousel-images');
    let galleryImages = [];
    
    // Handle gallery/images differently depending on format
    if (product.gallery) {
      try {
        // Try to parse gallery if it's a JSON string
        if (typeof product.gallery === 'string') {
          galleryImages = JSON.parse(product.gallery);
        } else if (Array.isArray(product.gallery)) {
          galleryImages = product.gallery;
        }
      } catch (e) {
        console.error('Failed to parse gallery:', e);
      }
    }
    
    // Fallback to single image if no gallery
    if (galleryImages.length === 0 && product.image) {
      galleryImages = [product.image];
    }
    
    // If still no images, use placeholder
    if (galleryImages.length === 0) {
      galleryImages = ['/src/client/assets/placeholder.jpg'];
    }
    
    // Create carousel items
    carouselInner.innerHTML = '';
    galleryImages.forEach((image, index) => {
      const item = document.createElement('div');
      item.className = `carousel-item ${index === 0 ? 'active' : ''}`;
      item.innerHTML = `<img src="${image}" class="d-block w-100" alt="${product.name}">`;
      carouselInner.appendChild(item);
    });
    
    // Set price
    const price = parseFloat(product.price) || 0;
    const salePrice = product.onSale && product.salePrice ? parseFloat(product.salePrice) : null;
    
    if (product.onSale && salePrice) {
      document.getElementById('product-price').textContent = `$${salePrice.toFixed(2)}`;
      document.getElementById('product-original-price').textContent = `$${price.toFixed(2)}`;
      document.getElementById('product-status').innerHTML = '<span class="badge bg-danger">Sale</span>';
    } else {
      document.getElementById('product-price').textContent = `$${price.toFixed(2)}`;
      document.getElementById('product-original-price').textContent = '';
    }
    
    // Set description
    document.getElementById('product-description').innerHTML = `
      <p>${product.description || 'No description available.'}</p>
    `;
    
    document.getElementById('full-description').innerHTML = `
      <p>${product.description || 'No description available.'}</p>
    `;
    
    // Set details
    let detailsHtml = '<table class="table table-bordered">';
    
    if (product.material) {
      detailsHtml += `<tr><th>Material</th><td>${product.material}</td></tr>`;
    }
    
    if (product.dimensions) {
      detailsHtml += `<tr><th>Dimensions</th><td>${product.dimensions}</td></tr>`;
    }
    
    if (product.weight) {
      detailsHtml += `<tr><th>Weight</th><td>${product.weight}</td></tr>`;
    }
    
    detailsHtml += `<tr><th>SKU</th><td>${product.id || 'N/A'}</td></tr>`;
    detailsHtml += '</table>';
    
    document.getElementById('product-details').innerHTML = detailsHtml;
    
    // Set metadata
    document.getElementById('product-category').textContent = product.categoryName || 'Uncategorized';
    document.getElementById('product-designer').textContent = product.designerName || 'Unknown';
    document.getElementById('product-code').textContent = `SKU-${product.id || 'N/A'}`;
    
    // Set reviews if available
    if (product.reviews && product.reviews.length > 0) {
      renderReviews(product.reviews);
    } else {
      document.getElementById('reviews-container').innerHTML = `
        <p>No reviews yet for this product.</p>
      `;
    }
    
    // Set rating
    let rating = 0;
    if (product.rating) {
      rating = parseFloat(product.rating);
    } else if (product.reviews && product.reviews.length > 0) {
      // Calculate average rating from reviews
      const totalRating = product.reviews.reduce((sum, review) => sum + (parseFloat(review.rating) || 0), 0);
      rating = totalRating / product.reviews.length;
    }
    
    const ratingHtml = generateRatingStars(rating);
    document.getElementById('product-rating').innerHTML = ratingHtml;
    
    // Setup add to cart button
    document.getElementById('add-to-cart').addEventListener('click', function() {
      const quantity = parseInt(document.getElementById('product-quantity').value) || 1;
      addToCart(product, quantity);
    });
    
    // Setup wishlist button
    document.getElementById('wishlist-btn').addEventListener('click', function() {
      toggleWishlist(product);
    });
  }
  
  // Generate rating stars
  function generateRatingStars(rating) {
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;
    
    let starsHtml = '<div class="product-rating">';
    for (let i = 0; i < fullStars; i++) {
      starsHtml += '<i class="bi bi-star-fill text-warning"></i> ';
    }
    if (hasHalfStar) {
      starsHtml += '<i class="bi bi-star-half text-warning"></i> ';
    }
    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
    for (let i = 0; i < emptyStars; i++) {
      starsHtml += '<i class="bi bi-star text-muted"></i> ';
    }
    
    starsHtml += `<span class="ms-2 text-muted">(${rating.toFixed(1)})</span>`;
    starsHtml += '</div>';
    
    return starsHtml;
  }
  
  // Setup quantity buttons
  function setupQuantityButtons() {
    const quantityInput = document.getElementById('product-quantity');
    const decreaseBtn = document.getElementById('decrease-quantity');
    const increaseBtn = document.getElementById('increase-quantity');
    
    decreaseBtn.addEventListener('click', function() {
      let quantity = parseInt(quantityInput.value) || 1;
      if (quantity > 1) {
        quantityInput.value = quantity - 1;
      }
    });
    
    increaseBtn.addEventListener('click', function() {
      let quantity = parseInt(quantityInput.value) || 1;
      quantityInput.value = quantity + 1;
    });
    
    quantityInput.addEventListener('change', function() {
      let quantity = parseInt(quantityInput.value) || 1;
      if (quantity < 1) {
        quantityInput.value = 1;
      }
    });
  }
  
  // Render reviews
  function renderReviews(reviews) {
    const reviewsContainer = document.getElementById('reviews-container');
    if (!reviewsContainer) return;
    
    if (!reviews || reviews.length === 0) {
      reviewsContainer.innerHTML = '<p>No reviews yet.</p>';
      return;
    }
    
    let reviewsHtml = '';
    
    reviews.forEach(review => {
      const rating = parseFloat(review.rating) || 0;
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      
      let starsHtml = '<div class="rating">';
      for (let i = 0; i < fullStars; i++) {
        starsHtml += '<i class="bi bi-star-fill text-warning"></i> ';
      }
      if (hasHalfStar) {
        starsHtml += '<i class="bi bi-star-half text-warning"></i> ';
      }
      const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
      for (let i = 0; i < emptyStars; i++) {
        starsHtml += '<i class="bi bi-star text-muted"></i> ';
      }
      starsHtml += '</div>';
      
      const reviewDate = review.date ? new Date(review.date).toLocaleDateString() : 'Unknown date';
      
      reviewsHtml += `
        <div class="review-card">
          <div class="d-flex justify-content-between align-items-center">
            <h5>${review.userName || 'Anonymous'}</h5>
            <small class="text-muted">${reviewDate}</small>
          </div>
          ${starsHtml}
          <h6>${review.title || 'Review'}</h6>
          <p>${review.content || 'No comment provided.'}</p>
        </div>
      `;
    });
    
    reviewsContainer.innerHTML = reviewsHtml;
  }
  
  // Load related products
  async function loadRelatedProducts(product) {
    try {
      const categoryId = product.categoryId || 0;
      
      // Get all products from API
      const productsData = await DataService.getAllProducts();
      if (!productsData || !productsData.success) {
        console.error('Failed to load related products');
        return;
      }
      
      // Get products array
      let products = [];
      if (productsData.data && productsData.data.products) {
        products = productsData.data.products;
      } else if (productsData.products) {
        products = productsData.products;
      }
      
      // Find products in the same category, excluding current product
      let relatedProducts = products.filter(p => p.categoryId === categoryId && p.id !== product.id);
      
      // If not enough products in the same category, add some other products
      if (relatedProducts.length < 4) {
        const otherProducts = products.filter(p => p.id !== product.id && p.categoryId !== categoryId);
        relatedProducts = relatedProducts.concat(otherProducts.slice(0, 4 - relatedProducts.length));
      }
      
      // Limit to max 4 related products
      relatedProducts = relatedProducts.slice(0, 4);
      
      // Render related products
      const container = document.getElementById('related-products-container');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (relatedProducts.length === 0) {
        container.innerHTML = '<p class="text-muted">No related products found.</p>';
        return;
      }
      
      relatedProducts.forEach(relatedProduct => {
        // Handle potentially empty fields
        const name = relatedProduct.name || 'Unnamed Product';
        const price = parseFloat(relatedProduct.price) || 0;
        const salePrice = relatedProduct.onSale && relatedProduct.salePrice ? parseFloat(relatedProduct.salePrice) : (relatedProduct.onSale ? price * 0.9 : null);
        
        // Get product image
        let imageSrc = '/src/client/assets/placeholder.jpg';
        if (relatedProduct.image) {
          imageSrc = relatedProduct.image;
        } else if (relatedProduct.gallery) {
          try {
            const gallery = typeof relatedProduct.gallery === 'string' ? JSON.parse(relatedProduct.gallery) : relatedProduct.gallery;
            if (Array.isArray(gallery) && gallery.length > 0) {
              imageSrc = gallery[0];
            }
          } catch (e) {
            console.error('Failed to parse gallery:', e);
          }
        }
        
        // Generate price HTML
        let priceHtml;
        if (relatedProduct.onSale && salePrice) {
          priceHtml = `
            <span class="product-price">$${salePrice.toFixed(2)}</span>
            <span class="product-price-discount">$${price.toFixed(2)}</span>
          `;
        } else {
          priceHtml = `<span class="product-price">$${price.toFixed(2)}</span>`;
        }
        
        // Generate product card HTML
        const productHtml = `
          <div class="col-6 col-md-3">
            <div class="product-card">
              ${relatedProduct.onSale ? '<span class="product-badge">SALE</span>' : ''}
              <a href="product_detail.html?id=${relatedProduct.id}" class="text-decoration-none text-dark">
                <img src="${imageSrc}" class="card-img-top" alt="${name}">
                <div class="card-body">
                  <h5 class="card-title">${name}</h5>
                  <div class="mb-2">${priceHtml}</div>
                  <button class="btn btn-outline-primary btn-sm w-100 add-to-cart-related" data-product-id="${relatedProduct.id}">
                    <i class="bi bi-cart-plus"></i> Add to Cart
                  </button>
                </div>
              </a>
            </div>
          </div>
        `;
        
        container.innerHTML += productHtml;
      });
      
      // Add related products' "Add to Cart" button events
      document.querySelectorAll('.add-to-cart-related').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const productId = parseInt(this.getAttribute('data-product-id'));
          const product = relatedProducts.find(p => p.id === productId);
          if (product) {
            addToCart(product, 1);
          }
        });
      });
    } catch (error) {
      console.error('Error loading related products:', error);
    }
  }
  
  // Add to cart
  function addToCart(product, quantity) {
    if (!product) return;
    
    // Validate quantity
    quantity = parseInt(quantity);
    if (isNaN(quantity) || quantity < 1) {
      quantity = 1;
    }
    
    // Get existing cart
    let cart = [];
    const cartData = localStorage.getItem('cart');
    if (cartData) {
      cart = JSON.parse(cartData);
    }
    
    // Calculate final price
    const price = parseFloat(product.price) || 0;
    const finalPrice = product.onSale ? (parseFloat(product.salePrice) || price * 0.9) : price;
    
    // Handle image URL
    let imageUrl = '/src/client/assets/placeholder.jpg';
    if (product.image) {
      imageUrl = product.image;
    } else if (product.gallery) {
      try {
        const gallery = typeof product.gallery === 'string' ? JSON.parse(product.gallery) : product.gallery;
        if (Array.isArray(gallery) && gallery.length > 0) {
          imageUrl = gallery[0];
        }
      } catch (e) {
        console.error('Failed to parse gallery:', e);
      }
    }
    
    // Check if product is already in cart
    const existingItem = cart.find(item => item.id === product.id);
    if (existingItem) {
      existingItem.quantity = (parseInt(existingItem.quantity) || 0) + quantity;
    } else {
      // Safely handle product description
      let description = 'No description available';
      if (product.description) {
        description = product.description.substring(0, 100);
        if (product.description.length > 100) {
          description += '...';
        }
      }
      
      cart.push({
        id: product.id || 0,
        name: product.name || 'Unnamed Product',
        price: finalPrice || 0,
        image: imageUrl,
        quantity: quantity || 1,
        description: description,
        categoryId: product.categoryId || null
      });
    }
    
    // Save to localStorage
    localStorage.setItem('cart', JSON.stringify(cart));
    
    // Show success message
    showToast(`${product.name || 'Product'} added to your cart!`, 'success');
    
    // Update navbar cart count
    updateCartCount();
  }
  
  // Update cart count
  function updateCartCount() {
    const cartData = localStorage.getItem('cart');
    const cartCount = document.getElementById('cart-count');
    
    if (!cartCount) return;
    
    if (cartData) {
      const cart = JSON.parse(cartData);
      const count = cart.reduce((total, item) => total + (parseInt(item.quantity) || 0), 0);
      cartCount.textContent = count;
      cartCount.style.display = count > 0 ? 'inline-block' : 'none';
    } else {
      cartCount.style.display = 'none';
    }
  }
  
  // Handle wishlist
  function toggleWishlist(product) {
    if (!product) return;
    
    let wishlist = [];
    const wishlistData = localStorage.getItem('wishlist');
    if (wishlistData) {
      wishlist = JSON.parse(wishlistData);
    }
    
    const productId = product.id;
    const isInWishlist = wishlist.some(item => item.id === productId);
    
    if (isInWishlist) {
      // Remove from wishlist
      wishlist = wishlist.filter(item => item.id !== productId);
      document.getElementById('wishlist-btn').classList.remove('active');
      showToast(`${product.name} removed from wishlist`, 'info');
    } else {
      // Add to wishlist
      // Handle image URL
      let imageUrl = '/src/client/assets/placeholder.jpg';
      if (product.image) {
        imageUrl = product.image;
      } else if (product.gallery) {
        try {
          const gallery = typeof product.gallery === 'string' ? JSON.parse(product.gallery) : product.gallery;
          if (Array.isArray(gallery) && gallery.length > 0) {
            imageUrl = gallery[0];
          }
        } catch (e) {
          console.error('Failed to parse gallery:', e);
        }
      }
      
      // Calculate price
      const price = parseFloat(product.price) || 0;
      const finalPrice = product.onSale ? (parseFloat(product.salePrice) || price * 0.9) : price;
      
      wishlist.push({
        id: productId,
        name: product.name || 'Unnamed Product',
        price: finalPrice,
        image: imageUrl,
        categoryId: product.categoryId || null
      });
      
      document.getElementById('wishlist-btn').classList.add('active');
      showToast(`${product.name} added to wishlist`, 'success');
    }
    
    localStorage.setItem('wishlist', JSON.stringify(wishlist));
  }
  
  // Check if product is in wishlist
  function checkWishlist(productId) {
    const wishlistData = localStorage.getItem('wishlist');
    if (wishlistData) {
      const wishlist = JSON.parse(wishlistData);
      const isInWishlist = wishlist.some(item => item.id === productId);
      
      if (isInWishlist) {
        document.getElementById('wishlist-btn').classList.add('active');
      }
    }
  }
  
  // Setup social sharing functionality
  function setupSocialSharing(product) {
    const productUrl = encodeURIComponent(window.location.href);
    const productName = encodeURIComponent(product.name || 'Purely Homemade Product');
    const productDesc = encodeURIComponent(product.description || 'Check out this amazing product from Purely Homemade!');
    
    const shareLinks = document.querySelectorAll('.social-share a');
    
    // Facebook share
    shareLinks[0].href = `https://www.facebook.com/sharer/sharer.php?u=${productUrl}`;
    shareLinks[0].target = '_blank';
    
    // Twitter share
    shareLinks[1].href = `https://twitter.com/intent/tweet?text=${productDesc}&url=${productUrl}`;
    shareLinks[1].target = '_blank';
    
    // Pinterest share
    let imageUrl = '';
    if (product.image) {
      imageUrl = encodeURIComponent(product.image);
    } else if (product.gallery) {
      try {
        const gallery = typeof product.gallery === 'string' ? JSON.parse(product.gallery) : product.gallery;
        if (Array.isArray(gallery) && gallery.length > 0) {
          imageUrl = encodeURIComponent(gallery[0]);
        }
      } catch (e) {
        console.error('Failed to parse gallery:', e);
      }
    }
    shareLinks[2].href = `https://pinterest.com/pin/create/button/?url=${productUrl}&media=${imageUrl}&description=${productDesc}`;
    shareLinks[2].target = '_blank';
    
    // Copy link
    shareLinks[3].addEventListener('click', function(e) {
      e.preventDefault();
      navigator.clipboard.writeText(window.location.href).then(() => {
        showToast('Link copied to clipboard!', 'success');
      }).catch(err => {
        console.error('Could not copy link: ', err);
      });
    });
  }
  
  // Show toast notification
  function showToast(message, type = 'success') {
    // Ensure toast container exists
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
      toastContainer = document.createElement('div');
      toastContainer.id = 'toast-container';
      toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
      document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast show`;
    toast.role = 'alert';
    toast.ariaLive = 'assertive';
    toast.ariaAtomic = 'true';
    
    // Set toast content with appropriate styling
    let bgClass = 'bg-success';
    if (type === 'error') bgClass = 'bg-danger';
    if (type === 'info') bgClass = 'bg-info';
    
    toast.innerHTML = `
      <div class="toast-header">
        <div class="rounded me-2 ${bgClass}" style="width: 20px; height: 20px;"></div>
        <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        ${message}
      </div>
    `;
    
    // Add to container
    toastContainer.appendChild(toast);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }
  
  // Show error
  function showError(message) {
    showToast(message, 'error');
  }
  
  // Initialize page
  document.addEventListener('DOMContentLoaded', function() {
    loadProductDetails();
  });
</script>
</body>
</html> 